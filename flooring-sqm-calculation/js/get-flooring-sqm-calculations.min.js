$(function(){function w(a){var b=$(a).parents("form"),c=b.find(".flooring-sqm-calculation-unit"),e=b.find(".flooring-sqm-calculation-manufacturer option:selected"),f=b.find(".flooring-sqm-calculation-collection option:selected"),d=b.find(".flooring-sqm-calculation-colour option:selected");a=b.find(".flooring-sqm-calculation-required-unit");var h=b.find(".flooring-sqm-calculation-price"),g=b.find(".flooring-sqm-calculation-total");b=b.find(".flooring-sqm-calculation-field");if(""!==e.val()&&""!==f.val()){c=
isNaN(+c.val())?0:+c.val();e=isNaN(+d.attr("data-sqm"))?0:+d.attr("data-sqm");d=isNaN(+d.attr("data-price"))?0:+d.attr("data-price");var k=0;$.each(b,function(){var b=$(this).val().split("<->")[2];k+=0<b?+b:0});b=isNaN(Math.ceil(c/e)*e)?0:Math.ceil(c/e)*e;c=d*b+k;a.val(b.toFixed(2));h.val(d.toFixed(2));g.val(c.toFixed(2))}else a.val("0"),h.val("0.00"),g.val("0.00")}function q(a){a=$(a).parents("form");var b=a.find(".flooring-sqm-calculation-collection");b.val("");b.find("option").not(":first").remove();
var c=a.find(".flooring-sqm-calculation-colour");c.val("");c.find("option").not(":first").remove();(a=a.find(".flooring-sqm-calculation-manufacturer").find("option:selected").attr("data-collections"))&&$.each(JSON.parse(a),function(a,c){a=JSON.stringify(c.colours);b.append('<option value="'+c.name+"<->"+c.code+'" data-code="'+c.code+'" data-sqm="'+c.sqm+'"  data-cost="'+c.cost+'" data-markup="'+c.markup+"\" data-colours='"+a+"'>"+c.name+"</option>")})}function v(a){var b=$(a).parents("form").find(".flooring-sqm-calculation-colour");
b.val("");b.find("option").not(":first").remove();(a=$(a).find("option:selected").attr("data-colours"))&&$.each(JSON.parse(a),function(a,e){b.append('<option value="'+e.name+"<->"+e.code+'" data-sqm="'+e.sqm+'"  data-cost="'+e.cost+'" data-markup="'+e.markup+'" data-price="'+e.price+'">'+e.name+"</option>")})}function A(a,b){b=$(b);var c=b.parents("form"),e=b.parents(".flooring-sqm-calculation-add-field-option-wrapper"),f=e.find(".flooring-sqm-calculation-add-field-option"),d=e.find(".flooring-sqm-calculation-add-field-option-submit"),
h=e.siblings(".flooring-sqm-calculation-field"),g=h.attr("data-code");b=c.find(".flooring-sqm-calculation-code").val();var k=c.find(".data-field, .number-input, select, [type='submit']");a&&$.ajax({url:"flooring-sqm-calculation/scripts/add-flooring-sqm-calculation-field-option.php",type:"POST",dataType:"json",data:{field_code:g,field_option_name:a,flooring_sqm_calculation_code:b},beforeSend:function(){f.prop("disabled",!0).addClass("field-loader");d.prop("disabled",!0).addClass("field-loader")},success:function(b){if(4===
b[0])document.location.replace(b[1]);else if(2===b[0])alert(b[1]);else if(1===b[0]){$(".flooring-sqm-calculation-add-field-option-x[data-field-code="+g+"]").before('<option value="'+b[2]+"<->"+b[1]+'<->0.00">'+b[2]+"</option>");var a=c.find(".checkbox-input"),l=c.parents(".flooring-sqm-calculation-quote-items-body").find(".checkbox-input:checked");a.is(":checked")&&l.length&&l.not(a).each(function(){$(this).parents(".update-flooring-sqm-calculation-quote-item-form").find(".data-field, .number-input, select, [type='submit']").prop("disabled",
!1)});f.val("");e.hide();k.prop("disabled",!1);h.show().val(b[2]+"<->"+b[1]+"<->0.00").change()}else alert(b);f.prop("disabled",!1).removeClass("field-loader");d.prop("disabled",!1).removeClass("field-loader")},error:function(b,a,c){f.prop("disabled",!1).removeClass("field-loader");d.prop("disabled",!1).removeClass("field-loader")}})}function p(a){a=$(a).parents(".flooring-sqm-calculation-quote-items-wrapper");var b=a.find(".flooring-sqm-calculation-quote-items-body").find("input[name='total']:not(:hidden)"),
c=$.isNumeric(+a.find(".group-discount").val())?+a.find(".group-discount").val():0,e=0;b.each(function(){e+=Number($(this).val().replace(/,/g,""))});b=e-e*c/100;a.find(".group-total").val(e.toFixed(2)).end().find(".group-discount").val(c).end().find(".group-discount-total").html(b.toFixed(2)).end().find(".group-discount-form").submit()}$.ajax({url:"flooring-sqm-calculation/scripts/get-flooring-sqm-calculations.php",type:"POST",dataType:"json",data:{cid},beforeSend:function(){},success:function(a){4===
a[0]?document.location.replace(a[1]):2===a[0]?alert(a[1]):1===a[0]?($.each(a[1],function(b,c){var e=c.code;if(1===c.location_select){b="<th>Locations</th>";var f="";$.each(a[2],function(b,a){f+='<option value="'+a.name+"<->"+a.code+'">'+a.name+"</option>"});var d='<td>\n                                                    <select name="location" data-column="location" class="flooring-sqm-calculation-location data-field">\n                                                        <option value=""></option>\n                                                        '+
f+"                                                    </select>\n                                                </td>"}else d=f=b="";var h="",g="";$.each(c.manufacturer_options,function(b,a){b=JSON.stringify(a.collections);h+='<option value="'+a.name+"<->"+a.code+"\" data-collections='"+b+"' data-code=\""+a.code+'">'+a.name+"</option>"});g='<td>\n                                        <select name="manufacturer" data-column="manufacturer" class="flooring-sqm-calculation-manufacturer data-field approved-disabled">\n                                            <option value=""></option>\n                                            '+
h+"                                        </select>\n                                    </td>";var k="",l="",m="",n="";$.each(c.fields,function(b,a){if(1===a.side)if(k+="<th>"+a.name+"</th>",0===a.field_type){var c="";$.each(a.options,function(b,a){c+='<option value="'+a.name+"<->"+a.code+"<->"+a.price+'">'+a.name+(0<a.price?" | "+a.price:"")+"</option>"});c+='<option class="flooring-sqm-calculation-add-field-option-x" data-field-code="'+a.code+'" value="add-new">Add New</option>';l+='<td>\n                                                        <select name="field['+
a.code+']" data-code="'+a.code+'" data-column="field-'+a.code+'" class="flooring-sqm-calculation-field data-field">\n                                                            <option value=""></option>\n                                                            '+c+'                                                        </select>\n                                                        <span class="flooring-sqm-calculation-add-field-option-wrapper">\n                                                            <input type="text" class="flooring-sqm-calculation-add-field-option text-input">\n                                                            <input type="button" class="flooring-sqm-calculation-add-field-option-submit bttn-input" value="\u271a">\n                                                            <input type="button" class="flooring-sqm-calculation-add-field-option-close bttn-input" value="\u2716">\n                                                        </span>\n                                                    </td>'}else l+=
'<td>\n                                                        <input type="text" name="field['+a.code+']" data-code="'+a.code+'" data-column="field-'+a.code+'" class="flooring-sqm-calculation-field data-field text-field" autocomplete="off">\n                                                    </td>';0===a.side&&(m+="<th>"+a.name+"</th>",0===a.field_type?(c="",$.each(a.options,function(a,b){c+='<option value="'+b.name+"<->"+b.code+"<->"+b.price+'">'+b.name+(0<b.price?" | "+b.price:"")+"</option>"}),
c+='<option class="flooring-sqm-calculation-add-field-option-x" data-field-code="'+a.code+'" value="add-new">Add New</option>',n+='<td>\n                                                            <select name="field['+a.code+']" data-code="'+a.code+'" data-column="field-'+a.code+'" class="flooring-sqm-calculation-field data-field">\n                                                                <option value=""></option>\n                                                                '+c+'                                                            </select>\n                                                            <span class="flooring-sqm-calculation-add-field-option-wrapper">\n                                                                <input type="text" class="flooring-sqm-calculation-add-field-option text-input">\n                                                                <input type="button" class="flooring-sqm-calculation-add-field-option-submit bttn-input" value="\u271a">\n                                                                <input type="button" class="flooring-sqm-calculation-add-field-option-close bttn-input" value="\u2716">\n                                                            </span>\n                                                        </td>'):
n+='<td>\n                                                            <input type="text" name="field['+a.code+']" data-code="'+a.code+'" data-column="field-'+a.code+'" class="flooring-sqm-calculation-field data-field text-field" autocomplete="off">\n                                                        </td>')});if(1===c.accessories_select){var r="",t="",B='<input type="hidden" class="accessory-option-array" value=\''+JSON.stringify(c.accessory_options)+"'>";$.each(c.accessory_options,function(b,
a){t+='<option data-code="'+a.code+'" value="'+a.code+"<->"+a.name+"<->"+a.price+'">'+a.name+" | "+a.price+"</option>"});r='<span class="flooring-sqm-calculation-accessories-wrapper">\n                                                <select class="flooring-sqm-calculation-accessories">\n                                                    <option value="">Accessories</option>\n                                                    '+t+'                                                </select>\n                                                <input type="tel" class="add-flooring-sqm-calculation-accessory-qty qty-input" placeholder="Qty">\n                                                <input type="button" class="add-flooring-sqm-calculation-accessories bttn-input" value="\u271a">\n                                            </span>'}else B=
r="";if(1===c.per_meters_select){var x="",C="",D='<input type="hidden" class="per-meter-option-array" value=\''+JSON.stringify(c.per_meter_options)+"'>";$.each(c.per_meter_options,function(a,b){C+='<option data-code="'+b.code+'" value="'+b.code+"<->"+b.name+"<->"+b.price+'">'+b.name+" | "+b.price+"</option>"});x='<span class="flooring-sqm-calculation-per-meters-wrapper">\n                                                <select class="flooring-sqm-calculation-per-meters">\n                                                    <option value="">Per Meter</option>\n                                                    '+
C+'                                                </select>\n                                                <input type="tel" class="add-flooring-sqm-calculation-per-meter-width qty-input" placeholder="Width">\n                                                <input type="button" class="add-flooring-sqm-calculation-per-meters bttn-input" value="\u271a">\n                                            </span>'}else D=x="";if(1===c.fitting_charges_select){var y="",E="",p='<input type="hidden" class="fitting-charge-option-array" value=\''+
JSON.stringify(c.fitting_charge_options)+"'>";$.each(c.fitting_charge_options,function(b,a){E+='<option data-code="'+a.code+'" value="'+a.code+"<->"+a.name+"<->"+a.price+'">'+a.name+" | "+a.price+"</option>"});y='<span class="flooring-sqm-calculation-fitting-charges-wrapper">\n                                                    <select class="flooring-sqm-calculation-fitting-charges">\n                                                        <option value="">Fitting Charges</option>\n                                                        '+
E+'                                                    </select>\n                                                    <input type="button" class="add-flooring-sqm-calculation-fitting-charges bttn-input" value="\u271a">\n                                                </span>'}else p=y="";1===c.status&&($('<li><a href="#tab-'+c.code+'">'+c.name+"</a></li>").prependTo("#flooring-sqm-calculation-tabs .tabs ul"),$('<div id="tab-'+c.code+'" class="flooring-sqm-calculation-tab-div"></div>').append($('<form class="add-flooring-sqm-calculation-quote-item-form" action="./" method="POST"></form>').append('<input type="hidden" class="cid" name="cid" value="'+
cid+'">').append('<input type="hidden" class="flooring-sqm-calculation-code" name="flooring-sqm-calculation-code" value="'+e+'">').append($('<table class="flooring-sqm-calculation-table"></table>').append($('<thead class="thead"></thead>').append($('<tr class="thead-tr"></tr>').append(k).append(b).append("<th>Unit</th>").append("<th>Manufacturer</th>").append("<th>Collections</th>").append("<th>Colours</th>").append("<th>Required unit</th>").append(m).append('<th>\n                                                                        <table class="right-fixed-column">\n                                                                            <tr>\n                                                                                <th>Price</th>\n                                                                                <th>Total</th>\n                                                                                <th>Qty</th>\n                                                                                <th>Add</th>\n                                                                            </tr>\n                                                                        </table>\n                                                                    </th>'))).append($("<tbody></tbody>").append($('<tr class="tbody-tr"></tr>').append(l).append(d).append('<td><input type="tel" name="unit" data-column="unit" class="flooring-sqm-calculation-unit number-input data-field" autocomplete="off" min="0"></td>').append(g).append('<td>\n                                                    <select name="collection" data-column="collection" class="flooring-sqm-calculation-collection data-field approved-disabled">\n                                                        <option value=""></option>\n                                                    </select>\n                                                </td>').append('<td>\n                                                <select name="colour" data-column="colour" class="flooring-sqm-calculation-colour data-field approved-disabled">\n                                                    <option value=""></option>\n                                                </select>\n                                            </td>').append('<td><input type="tel" name="required-unit" data-column="required_unit" class="flooring-sqm-calculation-required-unit number-input data-field" readonly autocomplete="off" min="0"></td>').append(n).append('<td>\n                                                                        <table class="right-fixed-column" style="margin-top: -20px;">\n                                                                            <tr>\n                                                                                <td><input type="tel" name="price" class="flooring-sqm-calculation-price price-input data-field" autocomplete="off"></td>\n                                                                                <td><input type="tel" name="total" class="flooring-sqm-calculation-total price-input data-field" autocomplete="off"></td>\n                                                                                <td><input type="number" name="qty" class="flooring-sqm-calculation-qty number-input" autocomplete="off" min="1" value="1"></td>\n                                                                                <td><input type="submit" class="bttn-input" value="\u271a"></td>\n                                                                            </tr>\n                                                                        </table>\n                                                                    </td>')))).append(B).append(D).append(p)).prependTo("#flooring-sqm-calculation-tabs .calculation-results").find(".bttn-input").button());
if("[]"!==JSON.stringify(c.quote_items)){$('<div id="flooring-sqm-calculation-quote-items-wrapper-'+e+'" class="flooring-sqm-calculation-quote-items-wrapper"></div>').append('<h2 class="flooring-sqm-calculation-header">'+c.name+"</h2>").append('<div id="quote-items-body-'+e+'" class="flooring-sqm-calculation-quote-items-body"></div>').append('<div class="bulk-action-button-wrapper">\n                                            <input type="button" class="bulk-action-button flooring-sqm-select-all-bttn" value="\u2714">\n                                            <input type="button" class="bulk-action-button flooring-sqm-calculation-bulk-delete-bttn" value="Delete">\n                                            <input type="button" class="bulk-action-button flooring-sqm-calculation-bulk-copy-bttn" value="Copy">\n                                            <a href="print/order-sheet-flooring-sqm-calculation-'+
e+"-"+cid+'" target="_blank" class="bulk-action-button print-bttn" style="width: 145px;">Print Order Sheet</a>\n                                            <a href="https://file-gen.blinq.com.au/clients/'+user_account+"/order-sheet-xlsx-flooring-sqm-calculation-"+e+"-"+cid+'" target="_blank" class="bulk-action-button print-bttn" style="width: 175px;">Print Order Sheet Xlsx</a>\n                                            <form class="group-discount-form" style="float: right; margin-right: -6px; font-size: 12px;">\n                                                <input type="tel" class="group-total price-input ui-state-default" autocomplete="off" style="float: left;" disabled>\n                                                <input type="tel" class="group-discount price-input ui-state-default" autocomplete="off" placeholder="%" style="float: left; margin-left: 1px !important; margin-right: 1px !important; text-align: center; width: 33px;" required>\n                                                <input type="hidden" class="flooring-sqm-calculation-code" value="'+
e+'">\n                                                <input type="submit" class="bttn-input ui-button ui-widget ui-state-default ui-corner-all" value="\u2714" role="button" aria-disabled="false" style="float: left;">\n                                            </form>\n                                            <div class="group-discount-total" style="float: right; line-height: 40px; margin-right: 400px; font-size: 22px; font-weight: bold;"></div>\n                                        </div>').prependTo("#flooring-sqm-calculation-quote-items-results").find(".bttn-input, .bulk-action-button").button();
b='<tr class="thead-tr">\n                                                <th class="left-fixed-column">#</th>\n                                                '+k+"                                                "+b+"                                                <th>Unit</th>\n                                                <th>Manufacturer</th>                                                <th>Collections</th>                                                <th>Colours</th>                                                <th>Required Unit</th>\n                                                "+
m+'                                                <th>\n                                                    <table class="right-fixed-column">\n                                                        <tr>\n                                                            <th>Price</th>\n                                                            <th>Total</th>\n                                                            <th>More</th>\n                                                            <th>Del</th>\n                                                        </tr>\n                                                    </table>\n                                                </th>\n                                            </tr>';
var F=1,u=0,z=0;$.each(c.quote_items,function(a,b){$('<form id="calculation-form-'+b.code+'" class="update-flooring-sqm-calculation-quote-item-form" action="./" method="POST">\n                                    <input type="hidden" name="cid" class="cid" value="'+cid+'">\n                                    <input type="hidden" name="flooring-sqm-calculation-code" class="flooring-sqm-calculation-code" value="'+e+'">\n                                    <input type="hidden" name="flooring-sqm-calculation-quote-item-code" class="flooring-sqm-calculation-quote-item-code" value="'+
b.code+'">\n                                    <table class="flooring-sqm-calculation-table">\n                                        <thead class="thead"></thead>\n                                        <tbody>\n                                            <tr>\n                                                <td class="left-fixed-column">\n                                                    <label class="checkbox-label" for="checkbox-'+b.code+'">'+F+'</label>\n                                                    <input type="checkbox" id="checkbox-'+
b.code+'"class="checkbox-input" name="quote-item-codes[]" value="'+b.code+'">\n                                                </td>\n                                                '+l+"                                                "+d+'                                                <td><input type="tel" name="unit" data-column="unit" class="flooring-sqm-calculation-unit number-input data-field" autocomplete="off" min="0" value="'+b.unit+'"></td>\n                                                '+
g+'                                                <td>\n                                                    <select name="collection" data-column="collection" class="flooring-sqm-calculation-collection data-field approved-disabled">\n                                                        <option value=""></option>\n                                                    </select>\n                                                </td>                                                <td>\n                                                <select name="colour" data-column="colour" class="flooring-sqm-calculation-colour data-field approved-disabled">\n                                                    <option value=""></option>\n                                                </select>\n                                            </td>                                                <td><input type="tel" name="required-unit" data-column="required_unit" class="flooring-sqm-calculation-required-unit number-input data-field" readonly autocomplete="off" min="0" value="'+
b.required_unit+'"></td>\n                                                '+n+'                                                <td>\n                                                    <table class="right-fixed-column" style="margin-top: -20px;">\n                                                        <tr>\n                                                            <td><input type="tel" name="price" data-column="price" class="flooring-sqm-calculation-price price-input data-field ui-state-default" autocomplete="off" value="'+
b.price+'"></td>\n                                                            <td><input type="tel" name="total" data-column="total" class="flooring-sqm-calculation-total price-input data-field ui-state-default" autocomplete="off" value="'+b.total+'"></td>\n                                                            <td><input type="button" class="flooring-sqm-calculation-table-more-bttn bttn-input" value="\u2605"></td>\n                                                            <td><input type="button" class="bttn-input delete-flooring-sqm-calculation-quote-item" value="\u2716"></td>\n                                                        </tr>\n                                                    </table>\n                                                </td>\n                                            </tr>\n                                        </tbody>\n                                    </table>\n                                    <table id="calculation-table-more-'+
b.code+'"  class="flooring-sqm-calculation-table-more">\n                                        <tr>\n                                            <td class="table-more-notes" colspan="3">\n                                                <textarea name="notes" data-column="notes" class="flooring-sqm-calculation-notes data-field" placeholder="Notes">'+b.notes+'</textarea>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td class="table-more-accessories">\n                                                '+
r+'                                            </td>\n                                            <td class="table-more-per-meters">\n                                                '+x+'                                            </td>\n                                            <td class="table-more-fitting-charges">\n                                                '+y+"                                            </td>\n                                        </tr>\n                                    </table>\n                                </form>").appendTo("#quote-items-body-"+
e).queue(function(){var a=$(this);a.find("[name='location']").val(b.location);a.find("[name='manufacturer']").val(b.manufacturer).queue(function(){q(this);$(this).dequeue()});a.find("[name='collection']").val(b.collection).queue(function(){v(this);$(this).dequeue()});a.find("[name='colour']").val(b.colour);"1"===quote_status&&a.find(".approved-disabled").css({"pointer-events":"none",background:"#f2f2f2"});$.each(b.fields,function(b,c){b=c.code;var e=c.name,d=c.price;c=c.flooring_sqm_calculation_field_code;
a.find("[name='field["+c+"]']").is("input")?a.find("[name='field["+c+"]']").val(e):a.find("[name='field["+c+"]']").val(e+"<->"+b+"<->"+d)});$.each(b.accessories,function(b,c){b=c.code;var e=c.name,d=+c.price;c=+c.qty;var g=(d*c).toFixed(2);a.find(".table-more-accessories").append('<span class="flooring-sqm-calculation-accessories-wrapper">\n                                                                                            <input type="text" class="flooring-sqm-calculation-accessory" readonly disabled value="'+
e+" | "+d+" x "+c+" = "+g+'">\n                                                                                            <input type="button" class="delete-flooring-sqm-calculation-accessory bttn-input" data-code="'+b+'" value="\u2716">\n                                                                                        </span>');a.find('.flooring-sqm-calculation-accessories option[data-code="'+b+'"]').hide()});$.each(b.per_meters,function(b,c){b=c.code;var e=c.name,d=+c.price;c=+c.width;var g=
(d*c).toFixed(2);a.find(".table-more-per-meters").append('<span class="flooring-sqm-calculation-per-meters-wrapper">\n                                                                                            <input type="text" class="flooring-sqm-calculation-per-meter" readonly disabled value="'+e+" | "+d+" x "+c+" = "+g+'">\n                                                                                            <input type="button" class="delete-flooring-sqm-calculation-per-meter bttn-input" data-code="'+
b+'" value="\u2716">\n                                                                                        </span>');a.find('.flooring-sqm-calculation-per-meters option[data-code="'+b+'"]').hide()});$.each(b.fitting_charges,function(b,c){b=c.code;var e=c.name;c=c.price;a.find(".table-more-fitting-charges").append('<span class="flooring-sqm-calculation-fitting-charges-wrapper">\n                                                                                                <input type="text" class="flooring-sqm-calculation-fitting-charge" readonly disabled value="'+
e+" | "+c+'">\n                                                                                                <input type="button" class="delete-flooring-sqm-calculation-fitting-charge bttn-input" data-code="'+b+'" value="\u2716">\n                                                                                            </span>');a.find('.flooring-sqm-calculation-fitting-charges option[data-code="'+b+'"]').hide()});var c=b.notes,e=a.find(".flooring-sqm-calculation-accessory").length,d=a.find(".flooring-sqm-calculation-per-meter").length,
g=a.find(".flooring-sqm-calculation-fitting-charge").length;c||e||d||g?a.find(".flooring-sqm-calculation-table-more-bttn").addClass("red"):a.find(".flooring-sqm-calculation-table-more-bttn").removeClass("red");F++;u=+u+ +b.total;z=b.discount;a.find(".bttn-input, .checkbox-input").button();a.dequeue()}).clearQueue().html()});$("#flooring-sqm-calculation-quote-items-wrapper-"+e).find(".group-total").val(u.toFixed(2)).end().find(".group-discount").val(z).end().find(".group-discount-total").html((u-u*
z/100).toFixed(2));$(".flooring-sqm-calculation-quote-items-body .flooring-sqm-calculation-table .thead").first().html(b)}else $('<div id="flooring-sqm-calculation-quote-items-wrapper-'+e+'" class="flooring-sqm-calculation-quote-items-wrapper"></div>').append('<h2 class="flooring-sqm-calculation-header">'+c.name+"</h2>").append('<div id="quote-items-body-'+e+'" class="flooring-sqm-calculation-quote-items-body"></div>').append('<div class="bulk-action-button-wrapper"></div>').prependTo("#flooring-sqm-calculation-quote-items-results").hide()}),
$(".tabs").tabs("refresh").tabs("option","active",0)):alert(JSON.stringify(a))},error:function(a,b,c){alert(JSON.stringify(a))}});$(document).on("click",".flooring-sqm-select-all-bttn",function(){var a=$(this),b=a.val(),c=a.parents(".flooring-sqm-calculation-quote-items-wrapper");"\u2714"===b?(c.find(".checkbox-input").prop("checked",!0).change().button("refresh"),a.val("\u2716")):(c.find(".checkbox-input").prop("checked",!1).change().button("refresh"),a.val("\u2714"))});$(document).on("click",".flooring-sqm-calculation-bulk-delete-bttn",
function(){var a=$(this),b=a.parents(".flooring-sqm-calculation-quote-items-wrapper"),c=b.find(".flooring-sqm-calculation-table .thead .thead-tr").clone(),e=b.find(".checkbox-input:checked"),f=e.serialize()+"&cid="+cid;f&&$.ajax({url:"flooring-sqm-calculation/scripts/delete-bulk-flooring-sqm-calculation-quote-items.php",type:"POST",dataType:"json",data:f,beforeSend:function(){a.prop("disabled",!1).addClass("field-loader")},success:function(d){4===d[0]?document.location.replace(d[1]):2===d[0]?(a.prop("disabled",
!1).removeClass("field-loader"),alert(d[1])):1===d[0]?($.each(e.serializeArray(),function(b,a){$("#calculation-form-"+a.value).remove()}),b.find(".update-flooring-sqm-calculation-quote-item-form").length?(b.find(".checkbox-label").each(function(b){$(this).find(".ui-button-text").html(b+1)}),b.find(".flooring-sqm-calculation-table .thead").first().html(c)):b.hide().find(".bulk-action-button-wrapper").empty(),a.prop("disabled",!1).removeClass("field-loader"),p(a),$("#getsum").load("getsum.php?cid="+
cid).fadeIn("fast"),$("#totalx").load("megaTotal.php?cid="+cid).fadeIn("fast")):(a.prop("disabled",!1).removeClass("field-loader"),alert(JSON.stringify(d)))},error:function(b,c,e){a.prop("disabled",!1).removeClass("field-loader");alert(JSON.stringify(b));alert("Error! @delete-bulk-flooring-sqm-calculation-quote-item")}})});$(document).on("click",".flooring-sqm-calculation-bulk-copy-bttn",function(){var a=$(this),b=a.parents(".flooring-sqm-calculation-quote-items-wrapper"),c=b.find(".checkbox-input:checked").serialize()+
"&cid="+cid;c&&$.ajax({url:"flooring-sqm-calculation/scripts/copy-bulk-flooring-sqm-calculation-quote-items.php",type:"POST",dataType:"json",data:c,beforeSend:function(){a.prop("disabled",!1).addClass("field-loader")},success:function(c){4===c[0]?document.location.replace(c[1]):2===c[0]?(a.prop("disabled",!1).removeClass("field-loader"),alert(c[1])):1===c[0]?($.each(c[1],function(a,c){var e=$("#calculation-form-"+a).clone();e.attr("id","calculation-form-"+c);e.find(".flooring-sqm-calculation-quote-item-code").val(c);
e.find(".checkbox-label").attr("for","checkbox-"+c);e.find(".checkbox-input").attr("id","checkbox-"+c).val(c);e.find(".checkbox-input").button();e.find(".flooring-sqm-calculation-table-more").attr("id","calculation-table-more-"+c).hide();e.find(".flooring-sqm-calculation-table .thead").empty();$(e).appendTo(b.find(".flooring-sqm-calculation-quote-items-body")).queue(function(){var b=$(this),c=$("#calculation-form-"+a);$.each(c.serializeArray(),function(a,c){b.find(".data-field[name='"+c.name+"']").val(c.value)});
b.dequeue()}).clearQueue()}),b.find(".checkbox-label").each(function(b){$(this).find(".ui-button-text").html(b+1)}),a.prop("disabled",!1).removeClass("field-loader"),p(a)):(a.prop("disabled",!1).removeClass("field-loader"),alert(JSON.stringify(c)))},error:function(b,c,d){a.prop("disabled",!1).removeClass("field-loader");alert(JSON.stringify(b));alert("Error! @delete-bulk-flooring-sqm-calculation-quote-item")}})});$(document).on("click",".delete-flooring-sqm-calculation-quote-item",function(){var a=
$(this),b=a.parents(".update-flooring-sqm-calculation-quote-item-form");b=a.parents(".update-flooring-sqm-calculation-quote-item-form");var c=b.find(".flooring-sqm-calculation-quote-item-code").val(),e=b.parents(".flooring-sqm-calculation-quote-items-wrapper"),f=e.find(".flooring-sqm-calculation-table .thead .thead-tr").clone();$.ajax({url:"flooring-sqm-calculation/scripts/delete-flooring-sqm-calculation-quote-item.php",type:"POST",dataType:"json",data:{cid,code:c},beforeSend:function(){a.prop("disabled",
!0).addClass("field-loader")},success:function(c){4===c[0]?document.location.replace(c[1]):2===c[0]?(a.prop("disabled",!1).removeClass("field-loader"),alert(c[1])):1===c[0]?(b.hide(),e.find(".flooring-sqm-calculation-table .thead").first().html(f),a.prop("disabled",!1).removeClass("field-loader"),p(b),$("#getsum").load("getsum.php?cid="+cid).fadeIn("fast"),$("#totalx").load("megaTotal.php?cid="+cid).fadeIn("fast"),b.remove(),e.find(".update-flooring-sqm-calculation-quote-item-form").length?e.find(".checkbox-label").each(function(b){$(this).find(".ui-button-text").html(b+
1)}):e.hide().find(".bulk-action-button-wrapper").empty()):(a.prop("disabled",!1).removeClass("field-loader"),alert(JSON.stringify(c)))},error:function(b,c,e){a.prop("disabled",!1).removeClass("field-loader");alert(JSON.stringify(b));alert("Error! @delete-bulk-flooring-sqm-calculation-quote-item")}})});$(document).on("click",".flooring-sqm-calculation-table-more-bttn",function(){$(this).parents("form").find(".flooring-sqm-calculation-table-more").toggle("slide",{direction:"up"},"fast")});$(document).on("change",
".checkbox-input",function(){var a=$(this),b=a.parents(".flooring-sqm-calculation-table");a.is(":checked")?b.find("select, .number-input, .text-field").addClass("ui-state-default"):b.find("select, .number-input, .text-field").removeClass("ui-state-default")});$(document).on("change","        .add-flooring-sqm-calculation-quote-item-form .flooring-sqm-calculation-unit,\n        .add-flooring-sqm-calculation-quote-item-form .flooring-sqm-calculation-manufacturer,\n        .add-flooring-sqm-calculation-quote-item-form .flooring-sqm-calculation-collection,\n        .add-flooring-sqm-calculation-quote-item-form .flooring-sqm-calculation-colour,\n        .add-flooring-sqm-calculation-quote-item-form .flooring-sqm-calculation-field",
function(){w(this)});$(document).on("change",".flooring-sqm-calculation-manufacturer",function(){("1"!==quote_status||$(this).parents("form").hasClass("add-flooring-sqm-calculation-quote-item-form"))&&q(this)});$(document).on("change",".flooring-sqm-calculation-collection",function(){("1"!==quote_status||$(this).parents("form").hasClass("add-flooring-sqm-calculation-quote-item-form"))&&v(this)});$(document).on("change",".flooring-sqm-calculation-field",function(a){var b=$(this),c=b.parents("form");
a=b.siblings(".flooring-sqm-calculation-add-field-option-wrapper");var e=a.find(".flooring-sqm-calculation-add-field-option"),f=c.find(".data-field, .number-input, select, [type='submit']"),d=c.find(".checkbox-input");c=c.parents(".flooring-sqm-calculation-quote-items-body").find(".checkbox-input:checked");d.is(":checked")&&c.length&&c.not(d).each(function(){var a=$(this).parents(".update-flooring-sqm-calculation-quote-item-form").find(".data-field, .number-input, select, [type='submit']");"add-new"===
b.val()&&a.prop("disabled",!0)});"add-new"===b.val()&&(b.hide(),a.show(),e.focus(),f.prop("disabled",!0))});$(document).on("keypress",".flooring-sqm-calculation-add-field-option",function(a){if(13===a.keyCode){a.preventDefault();a=$(this);var b=a.parents(".flooring-sqm-calculation-add-field-option-wrapper").find(".flooring-sqm-calculation-add-field-option").val();A(b,a);return!1}});$(document).on("click",".flooring-sqm-calculation-add-field-option-submit",function(a){a.preventDefault();a=$(this);
var b=a.siblings(".flooring-sqm-calculation-add-field-option").val();A(b,a);return!1});$(document).on("click",".flooring-sqm-calculation-add-field-option-close",function(){var a=$(this),b=a.parents("form");a=a.parents(".flooring-sqm-calculation-add-field-option-wrapper");var c=a.find(".flooring-sqm-calculation-add-field-option"),e=a.siblings(".flooring-sqm-calculation-field"),f=b.find(".data-field, .number-input, select, [type='submit']"),d=b.find(".checkbox-input");b=b.parents(".flooring-sqm-calculation-quote-items-body").find(".checkbox-input:checked");
d.is(":checked")&&b.length&&b.not(d).each(function(){$(this).parents(".update-flooring-sqm-calculation-quote-item-form").find(".data-field, .number-input, select, [type='submit']").prop("disabled",!1)});c.val("");a.hide();f.prop("disabled",!1);e.show().val("").change().focus()});$(document).on("submit",".add-flooring-sqm-calculation-quote-item-form",function(a){a.preventDefault();var b=$(this),c=b.find('[type="submit"]'),e=b.find(".flooring-sqm-calculation-table .thead-tr"),f=b.find(".flooring-sqm-calculation-table .tbody-tr"),
d=b.find(".flooring-sqm-calculation-code").val(),h=b.find(".accessory-option-array").val(),g=b.find(".per-meter-option-array").val(),k=b.find(".fitting-charge-option-array").val(),l=$("#flooring-sqm-calculation-quote-items-wrapper-"+d),m=$.isNumeric(+l.find(".group-discount").val())?+l.find(".group-discount").val():0;a=b.serialize();$.ajax({url:"flooring-sqm-calculation/scripts/add-flooring-sqm-calculation-quote-item.php",type:"POST",dataType:"json",data:a,beforeSend:function(b){c.prop("disabled",
!1).addClass("field-loader")},success:function(a){4===a[0]?document.location.replace(a[1]):2===a[0]?(c.prop("disabled",!1).removeClass("field-loader"),alert(a[1])):1===a[0]?($(b).find(".data-field:first").focus(),$.each(a[1],function(a,c){$("#quote-items-body-"+d+" .flooring-sqm-calculation-table").length?a="":(a=e.clone(),a.prepend('<th class="left-fixed-column">#</th>'),a.find(".right-fixed-column").html("<tr>\n                                                                                    <th>Price</th>\n                                                                                    <th>total</th>\n                                                                                    <th>More</th>\n                                                                                    <th>Del</th>\n                                                                                </tr>"),
a=a.html(),$("#flooring-sqm-calculation-quote-items-wrapper-"+d).show());var l=f.clone();l.prepend('<td class="left-fixed-column">\n                                                        <label class="checkbox-label" for="checkbox-'+c+'"></label>\n                                                        <input type="checkbox" id="checkbox-'+c+'" class="checkbox-input" name="quote-item-codes[]" value="'+c+'">\n                                                    </td>');l.find(".right-fixed-column").html('<tr>\n                                                                                <td><input type="tel" name="price" data-column="price" class="flooring-sqm-calculation-price price-input data-field ui-state-default" autocomplete="off"></td>\n                                                                                <td><input type="tel" name="total" data-column="total" class="flooring-sqm-calculation-total price-input data-field ui-state-default" autocomplete="off"></td>\n                                                                                <td><input type="button" class="flooring-sqm-calculation-table-more-bttn bttn-input" value="\u2605"></td>\n                                                                                <td><input type="button" class="bttn-input delete-flooring-sqm-calculation-quote-item" value="\u2716"></td>\n                                                                            </tr>');
"1"===quote_status&&l.find(".approved-disabled").css({"pointer-events":"none",background:"#f2f2f2"});if(h){var m="",n="";$.each(JSON.parse(h),function(b,a){n+='<option data-code="'+a.code+'" value="'+a.code+"<->"+a.name+"<->"+a.price+'">'+a.name+" | "+a.price+"</option>"});m='<span class="flooring-sqm-calculation-accessories-wrapper">\n                                                    <select class="flooring-sqm-calculation-accessories">\n                                                        <option value="">Accessories</option>\n                                                        '+
n+'                                                    </select>\n                                                    <input type="tel" class="add-flooring-sqm-calculation-accessory-qty qty-input" placeholder="Qty">\n                                                    <input type="button" class="add-flooring-sqm-calculation-accessories bttn-input" value="\u271a">\n                                                </span>'}else m="";if(g){var t="",p="";$.each(JSON.parse(g),function(a,b){p+='<option data-code="'+
b.code+'" value="'+b.code+"<->"+b.name+"<->"+b.price+'">'+b.name+" | "+b.price+"</option>"});t='<span class="flooring-sqm-calculation-per-meters-wrapper">\n                                                    <select class="flooring-sqm-calculation-per-meters">\n                                                        <option value="">Per Meters</option>\n                                                        '+p+'                                                    </select>\n                                                    <input type="tel" class="add-flooring-sqm-calculation-per-meter-width qty-input" placeholder="Width">\n                                                    <input type="button" class="add-flooring-sqm-calculation-per-meters bttn-input" value="\u271a">\n                                                </span>'}else t=
"";if(k){var r="",q="";$.each(JSON.parse(k),function(b,a){q+='<option data-code="'+a.code+'" value="'+a.code+"<->"+a.name+"<->"+a.price+'">'+a.name+" | "+a.price+"</option>"});r='<span class="flooring-sqm-calculation-fitting-charges-wrapper">\n                                                        <select class="flooring-sqm-calculation-fitting-charges">\n                                                            <option value="">Fitting Charges</option>\n                                                            '+
q+'                                                        </select>\n                                                        <input type="button" class="add-flooring-sqm-calculation-fitting-charges bttn-input" value="\u271a">\n                                                    </span>'}else r="";$('<form id="calculation-form-'+c+'" class="update-flooring-sqm-calculation-quote-item-form" action="./" method="POST">\n                                <input type="hidden" name="cid" class="cid" value="'+
cid+'">\n                                <input type="hidden" name="flooring-sqm-calculation-code" class="flooring-sqm-calculation-code" value="'+d+'">\n                                <input type="hidden" name="flooring-sqm-calculation-quote-item-code" class="flooring-sqm-calculation-quote-item-code" value="'+c+'">\n                                <table class="flooring-sqm-calculation-table">\n                                    <thead class="thead">\n                                        <tr class="thead-tr">'+
a+"</tr>\n                                    </thead>\n                                    <tbody>\n                                        "+l.html()+'                                    </tbody>\n                                </table>\n                                <table id="calculation-table-more-'+c+'"  class="flooring-sqm-calculation-table-more">\n                                    <tr>\n                                        <td class="table-more-notes" colspan="3">\n                                            <textarea name="notes" data-column="notes" class="flooring-sqm-calculation-notes data-field" placeholder="Notes"></textarea>\n                                        </td>\n                                    </tr>\n                                    <tr>\n                                        <td class="table-more-accessories">\n                                            '+
m+'                                        </td>\n                                        <td class="table-more-per-meters">\n                                            '+t+'                                        </td>\n                                        <td class="table-more-fitting-charges">\n                                            '+r+"                                        </td>\n                                    </tr>\n                                </table>\n                            </form>").appendTo("#quote-items-body-"+
d).queue(function(){var a=$(this);$.each(b.serializeArray(),function(b,c){a.find("[name='"+c.name+"']").val(c.value)});a.find(".bttn-input, .checkbox-input").button();a.dequeue()}).clearQueue()}),l.find(".bulk-action-button-wrapper").html('<input type="button" class="bulk-action-button flooring-sqm-select-all-bttn" value="\u2714">\n                                                                            <input type="button" class="bulk-action-button flooring-sqm-calculation-bulk-delete-bttn" value="Delete">\n                                                                            <input type="button" class="bulk-action-button flooring-sqm-calculation-bulk-copy-bttn" value="Copy">\n                                                                            <a href="print/order-sheet-flooring-sqm-calculation-'+
d+"-"+cid+'" target="_blank" class="bulk-action-button print-bttn" style="width: 145px;">Print Order Sheet</a>\n                                                                            <a href="https://file-gen.blinq.com.au/clients/'+user_account+"/order-sheet-xlsx-flooring-sqm-calculation-"+d+"-"+cid+'" target="_blank" class="bulk-action-button print-bttn" style="width: 175px;">Print Order Sheet Xlsx</a>\n                                                                            <form class="group-discount-form" style="float: right; margin-right: -6px; font-size: 12px;">\n                                                                                <input type="tel" class="group-total price-input ui-state-default" autocomplete="off" style="float: left;" disabled value="">\n                                                                                <input type="tel" class="group-discount price-input ui-state-default" autocomplete="off" placeholder="%" value="'+
m+'" style="float: left; margin-left: 1px !important; margin-right: 1px !important; text-align: center; width: 33px;" required value="">\n                                                                                <input type="hidden" class="flooring-sqm-calculation-code" value="'+d+'">\n                                                                                <input type="submit" class="bttn-input ui-button ui-widget ui-state-default ui-corner-all" value="\u2714" role="button" aria-disabled="false" style="float: left;">\n                                                                            </form>\n                                                                            <div class="group-discount-total" style="float: right; line-height: 40px; margin-right: 400px; font-size: 22px; font-weight: bold;"></div>\n                                                                            ').find(".bulk-action-button").button(),
l.find(".checkbox-label").each(function(a){$(this).find(".ui-button-text").html(a+1)}),b[0].reset(),b.find(".flooring-sqm-calculation-material").val("").find("option").not(":first").remove(),b.find(".flooring-sqm-calculation-colour").val("").find("option").not(":first").remove(),c.prop("disabled",!1).removeClass("field-loader"),p(l.find(".group-discount-form"))):(c.prop("disabled",!1).removeClass("field-loader"),alert(JSON.stringify(a)))},error:function(a,b,e){c.prop("disabled",!1).removeClass("field-loader");
alert(JSON.stringify(a));alert("Error! @add-flooring-sqm-calculation-quote-item")}})});$(document).on("change",".update-flooring-sqm-calculation-quote-item-form .data-field",function(a){a.preventDefault();var b=$(this),c=b.attr("name"),e=b.attr("data-column"),f=b.val();if("add-new"===f)return!1;var d=b.parents(".update-flooring-sqm-calculation-quote-item-form"),h=d.find(".checkbox-input"),g=d.parents(".flooring-sqm-calculation-quote-items-body").find(".checkbox-input:checked"),k="";h.is(":checked")&&
g.length?(k=[],g.each(function(){var a=$(this).parents(".update-flooring-sqm-calculation-quote-item-form"),b=a.find("[name='"+c+"']");b.val(f);("unit"===b.attr("name")||"manufacturer"===b.attr("name")||"collection"===b.attr("name")||"colour"===b.attr("name")||b.hasClass("flooring-sqm-calculation-field"))&&"1"!==quote_status&&w(b);"manufacturer"===e&&"1"!==quote_status&&q(b);"collection"===e&&"1"!==quote_status&&v(b);k.push(a.serialize())})):(("unit"===b.attr("name")||"manufacturer"===b.attr("name")||
"collection"===b.attr("name")||"colour"===b.attr("name")||b.hasClass("flooring-sqm-calculation-field"))&&"1"!==quote_status&&w(b),"manufacturer"===e&&"1"!==quote_status&&q(b),"collection"===e&&"1"!==quote_status&&v(b),k=[d.serialize()]);$.ajax({url:"flooring-sqm-calculation/scripts/update-flooring-sqm-calculation-quote-item.php",type:"POST",dataType:"json",data:{quote_items_array:k},beforeSend:function(){b.toggleClass("field-loader")},success:function(a){if(4===a[0])document.location.replace(a[1]);
else if(2===a[0])b.toggleClass("field-loader"),alert(a[1]);else if(1===a[0]){if(h.is(":checked")&&g.length)g.each(function(){var a=$(this).parents(".update-flooring-sqm-calculation-quote-item-form"),b=a.find(".flooring-sqm-calculation-notes").val().length,c=a.find(".flooring-sqm-calculation-accessory").length,e=a.find(".flooring-sqm-calculation-per-meter").length,d=a.find(".flooring-sqm-calculation-fitting-charge").length;b||c||e||d?a.find(".flooring-sqm-calculation-table-more-bttn").addClass("red"):
a.find(".flooring-sqm-calculation-table-more-bttn").removeClass("red")});else{a=d.find(".flooring-sqm-calculation-notes").val().length;var c=d.find(".flooring-sqm-calculation-accessory").length,e=d.find(".flooring-sqm-calculation-per-meter").length,k=d.find(".flooring-sqm-calculation-fitting-charge").length;a||c||e||k?d.find(".flooring-sqm-calculation-table-more-bttn").addClass("red"):d.find(".flooring-sqm-calculation-table-more-bttn").removeClass("red")}b.toggleClass("field-loader");("unit"===b.attr("name")||
"manufacturer"===b.attr("name")||"collection"===b.attr("name")||"colour"===b.attr("name")||"total"===b.attr("name")||b.hasClass("flooring-sqm-calculation-field"))&&p(d)}else b.toggleClass("field-loader"),alert(JSON.stringify(a))},error:function(a,c,e){b.toggleClass("field-loader");alert(JSON.stringify(a));alert("Error! @update-flooring-sqm-calculation-quote-item")}})});$(document).on("keypress",".add-flooring-sqm-calculation-accessory-qty",function(a){13===a.keyCode&&(a.preventDefault(),$(this).siblings(".add-flooring-sqm-calculation-accessories").click())});
$(document).on("click",".add-flooring-sqm-calculation-accessories",function(){var a=$(this),b=a.parents(".update-flooring-sqm-calculation-quote-item-form"),c=a.siblings(".flooring-sqm-calculation-accessories"),e=a.siblings(".add-flooring-sqm-calculation-accessory-qty"),f=b.find(".flooring-sqm-calculation-code").val(),d=b.find(".flooring-sqm-calculation-quote-item-code").val(),h=c.val(),g=+e.val();g=0!==g?g:1;h&&$.ajax({url:"flooring-sqm-calculation/scripts/add-flooring-sqm-calculation-quote-item-accessory.php",
type:"POST",dataType:"json",data:{cid,flooring_sqm_calculation_code:f,flooring_sqm_calculation_quote_item_code:d,accessory:h,accessory_qty:g},beforeSend:function(){a.prop("disabled",!1).addClass("field-loader");c.addClass("field-loader");e.addClass("field-loader")},success:function(d){if(4===d[0])document.location.replace(d[1]);else if(2===d[0])a.prop("disabled",!1).removeClass("field-loader"),c.removeClass("field-loader"),e.removeClass("field-loader"),alert(d[1]);else if(1===d[0]){d=h.split("<->")[0];
var k=h.split("<->")[1],f=+h.split("<->")[2].replace(/,/g,""),n=(f*g).toFixed(2);b.find(".table-more-accessories").append('<span class="flooring-sqm-calculation-accessories-wrapper">\n                                                                                <input type="text" class="flooring-sqm-calculation-accessory" readonly disabled value="'+k+" | "+f+" x "+g+" = "+n+'">\n                                                                                <input type="button" class="delete-flooring-sqm-calculation-accessory bttn-input" data-code="'+
d+'" value="\u2716">\n                                                                            </span>').find(".bttn-input").button();c.find('option[data-code="'+d+'"]').hide();c.val("").focus();e.val("");d=b.find(".flooring-sqm-calculation-notes").val().length;k=b.find(".flooring-sqm-calculation-accessory").length;f=b.find(".flooring-sqm-calculation-per-meter").length;n=b.find(".flooring-sqm-calculation-fitting-charge").length;d||k||f||n?b.find(".flooring-sqm-calculation-table-more-bttn").addClass("red"):
b.find(".flooring-sqm-calculation-table-more-bttn").removeClass("red");a.prop("disabled",!1).removeClass("field-loader");c.removeClass("field-loader");e.removeClass("field-loader");$("#getsum").load("getsum.php?cid="+cid).fadeIn("fast");$("#totalx").load("megaTotal.php?cid="+cid).fadeIn("fast")}else a.prop("disabled",!1).removeClass("field-loader"),c.removeClass("field-loader"),e.removeClass("field-loader"),alert(JSON.stringify(d))},error:function(b,d,g){a.prop("disabled",!1).removeClass("field-loader");
c.removeClass("field-loader");e.removeClass("field-loader");alert(JSON.stringify(b));alert("Error! @add-flooring-sqm-calculation-quote-item-accessory")}})});$(document).on("click",".delete-flooring-sqm-calculation-accessory",function(){var a=$(this),b=a.parents(".update-flooring-sqm-calculation-quote-item-form"),c=b.find(".flooring-sqm-calculation-accessories"),e=a.parent(".flooring-sqm-calculation-accessories-wrapper"),f=b.find(".flooring-sqm-calculation-code").val(),d=b.find(".flooring-sqm-calculation-quote-item-code").val(),
h=a.attr("data-code");$.ajax({url:"flooring-sqm-calculation/scripts/delete-flooring-sqm-calculation-quote-item-accessory.php",type:"POST",dataType:"json",data:{cid,flooring_sqm_calculation_code:f,flooring_sqm_calculation_quote_item_code:d,accessory_code:h},beforeSend:function(){a.prop("disabled",!1).addClass("field-loader")},success:function(d){if(4===d[0])document.location.replace(d[1]);else if(2===d[0])a.prop("disabled",!1).removeClass("field-loader"),alert(d[1]);else if(1===d[0]){e.remove();c.find('option[data-code="'+
h+'"]').show();c.val("");d=b.find(".flooring-sqm-calculation-notes").val().length;var g=b.find(".flooring-sqm-calculation-accessory").length,f=b.find(".flooring-sqm-calculation-per-meter").length,m=b.find(".flooring-sqm-calculation-fitting-charge").length;d||g||f||m?b.find(".flooring-sqm-calculation-table-more-bttn").addClass("red"):b.find(".flooring-sqm-calculation-table-more-bttn").removeClass("red");a.prop("disabled",!1).removeClass("field-loader");$("#getsum").load("getsum.php?cid="+cid).fadeIn("fast");
$("#totalx").load("megaTotal.php?cid="+cid).fadeIn("fast")}else a.prop("disabled",!1).removeClass("field-loader"),alert(JSON.stringify(d))},error:function(b,c,e){a.prop("disabled",!1).removeClass("field-loader");alert(JSON.stringify(b));alert("Error! @delete-flooring-sqm-calculation-quote-item-accessory")}})});$(document).on("keypress",".add-flooring-sqm-calculation-per-meter-width",function(a){13===a.keyCode&&(a.preventDefault(),$(this).siblings(".add-flooring-sqm-calculation-per-meters").click())});
$(document).on("click",".add-flooring-sqm-calculation-per-meters",function(){var a=$(this),b=a.parents(".update-flooring-sqm-calculation-quote-item-form"),c=a.siblings(".flooring-sqm-calculation-per-meters"),e=a.siblings(".add-flooring-sqm-calculation-per-meter-width"),f=b.find(".flooring-sqm-calculation-code").val(),d=b.find(".flooring-sqm-calculation-quote-item-code").val(),h=c.val(),g=+e.val();g=0!==g?g:1;h&&$.ajax({url:"flooring-sqm-calculation/scripts/add-flooring-sqm-calculation-quote-item-per-meter.php",
type:"POST",dataType:"json",data:{cid,flooring_sqm_calculation_code:f,flooring_sqm_calculation_quote_item_code:d,per_meter:h,per_meter_width:g},beforeSend:function(){a.prop("disabled",!1).addClass("field-loader");c.addClass("field-loader");e.addClass("field-loader")},success:function(d){if(4===d[0])document.location.replace(d[1]);else if(2===d[0])a.prop("disabled",!1).removeClass("field-loader"),c.removeClass("field-loader"),e.removeClass("field-loader"),alert(d[1]);else if(1===d[0]){d=h.split("<->")[0];
var f=h.split("<->")[1],k=+h.split("<->")[2].replace(/,/g,""),n=(k*g).toFixed(2);b.find(".table-more-per-meters").append('<span class="flooring-sqm-calculation-per-meters-wrapper">\n                                                                                <input type="text" class="flooring-sqm-calculation-per-meter" readonly disabled value="'+f+" | "+k+" x "+g+" = "+n+'">\n                                                                                <input type="button" class="delete-flooring-sqm-calculation-per-meter bttn-input" data-code="'+
d+'" value="\u2716">\n                                                                            </span>').find(".bttn-input").button();c.find('option[data-code="'+d+'"]').hide();c.val("").focus();e.val("");d=b.find(".flooring-sqm-calculation-notes").val().length;f=b.find(".flooring-sqm-calculation-accessory").length;k=b.find(".flooring-sqm-calculation-per-meter").length;n=b.find(".flooring-sqm-calculation-fitting-charge").length;d||f||k||n?b.find(".flooring-sqm-calculation-table-more-bttn").addClass("red"):
b.find(".flooring-sqm-calculation-table-more-bttn").removeClass("red");a.prop("disabled",!1).removeClass("field-loader");c.removeClass("field-loader");e.removeClass("field-loader");$("#getsum").load("getsum.php?cid="+cid).fadeIn("fast");$("#totalx").load("megaTotal.php?cid="+cid).fadeIn("fast")}else a.prop("disabled",!1).removeClass("field-loader"),c.removeClass("field-loader"),e.removeClass("field-loader"),alert(JSON.stringify(d))},error:function(b,d,g){a.prop("disabled",!1).removeClass("field-loader");
c.removeClass("field-loader");e.removeClass("field-loader");alert(JSON.stringify(b));alert("Error! @add-flooring-sqm-calculation-quote-item-per-meter")}})});$(document).on("click",".delete-flooring-sqm-calculation-per-meter",function(){var a=$(this),b=a.parents(".update-flooring-sqm-calculation-quote-item-form"),c=b.find(".flooring-sqm-calculation-per-meters"),e=a.parent(".flooring-sqm-calculation-per-meters-wrapper"),f=b.find(".flooring-sqm-calculation-code").val(),d=b.find(".flooring-sqm-calculation-quote-item-code").val(),
h=a.attr("data-code");$.ajax({url:"flooring-sqm-calculation/scripts/delete-flooring-sqm-calculation-quote-item-per-meter.php",type:"POST",dataType:"json",data:{cid,flooring_sqm_calculation_code:f,flooring_sqm_calculation_quote_item_code:d,per_meter_code:h},beforeSend:function(){a.prop("disabled",!1).addClass("field-loader")},success:function(d){if(4===d[0])document.location.replace(d[1]);else if(2===d[0])a.prop("disabled",!1).removeClass("field-loader"),alert(d[1]);else if(1===d[0]){e.remove();c.find('option[data-code="'+
h+'"]').show();c.val("");d=b.find(".flooring-sqm-calculation-notes").val().length;var g=b.find(".flooring-sqm-calculation-accessory").length,f=b.find(".flooring-sqm-calculation-per-meter").length,m=b.find(".flooring-sqm-calculation-fitting-charge").length;d||g||f||m?b.find(".flooring-sqm-calculation-table-more-bttn").addClass("red"):b.find(".flooring-sqm-calculation-table-more-bttn").removeClass("red");a.prop("disabled",!1).removeClass("field-loader");$("#getsum").load("getsum.php?cid="+cid).fadeIn("fast");
$("#totalx").load("megaTotal.php?cid="+cid).fadeIn("fast")}else a.prop("disabled",!1).removeClass("field-loader"),alert(JSON.stringify(d))},error:function(b,c,d){a.prop("disabled",!1).removeClass("field-loader");alert(JSON.stringify(b));alert("Error! @delete-flooring-sqm-calculation-quote-item-per-meter")}})});$(document).on("click",".add-flooring-sqm-calculation-fitting-charges",function(){var a=$(this),b=a.parents(".update-flooring-sqm-calculation-quote-item-form"),c=a.siblings(".flooring-sqm-calculation-fitting-charges"),
e=b.find(".flooring-sqm-calculation-code").val(),f=b.find(".flooring-sqm-calculation-quote-item-code").val(),d=c.val();d&&$.ajax({url:"flooring-sqm-calculation/scripts/add-flooring-sqm-calculation-quote-item-fitting-charge.php",type:"POST",dataType:"json",data:{cid,flooring_sqm_calculation_code:e,flooring_sqm_calculation_quote_item_code:f,fitting_charge:d},beforeSend:function(){a.prop("disabled",!1).addClass("field-loader");c.toggleClass("field-loader")},success:function(e){if(4===e[0])document.location.replace(e[1]);
else if(2===e[0])a.prop("disabled",!1).removeClass("field-loader"),c.toggleClass("field-loader"),alert(e[1]);else if(1===e[0]){e=d.split("<->")[0];var g=d.split("<->")[1],f=d.split("<->")[2];b.find(".table-more-fitting-charges").append('<span class="flooring-sqm-calculation-fitting-charges-wrapper">\n                                                                                    <input type="text" class="flooring-sqm-calculation-fitting-charge" readonly disabled value="'+g+" | "+f+'">\n                                                                                    <input type="button" class="delete-flooring-sqm-calculation-fitting-charge bttn-input" data-code="'+
e+'" value="\u2716">\n                                                                                </span>').find(".bttn-input").button();c.find('option[data-code="'+e+'"]').hide();c.val("");e=b.find(".flooring-sqm-calculation-notes").val().length;g=b.find(".flooring-sqm-calculation-accessory").length;f=b.find(".flooring-sqm-calculation-per-meter").length;var h=b.find(".flooring-sqm-calculation-fitting-charge").length;e||g||f||h?b.find(".flooring-sqm-calculation-table-more-bttn").addClass("red"):
b.find(".flooring-sqm-calculation-table-more-bttn").removeClass("red");a.prop("disabled",!1).removeClass("field-loader");c.toggleClass("field-loader");$("#getsum").load("getsum.php?cid="+cid).fadeIn("fast");$("#totalx").load("megaTotal.php?cid="+cid).fadeIn("fast")}else a.prop("disabled",!1).removeClass("field-loader"),c.toggleClass("field-loader"),alert(JSON.stringify(e))},error:function(b,e,d){a.prop("disabled",!1).removeClass("field-loader");c.toggleClass("field-loader");alert(JSON.stringify(b));
alert("Error! @add-flooring-sqm-calculation-quote-item-fitting-charge")}})});$(document).on("click",".delete-flooring-sqm-calculation-fitting-charge",function(){var a=$(this),b=a.parents(".update-flooring-sqm-calculation-quote-item-form"),c=b.find(".flooring-sqm-calculation-fitting-charges"),e=a.parent(".flooring-sqm-calculation-fitting-charges-wrapper"),f=b.find(".flooring-sqm-calculation-code").val(),d=b.find(".flooring-sqm-calculation-quote-item-code").val(),h=a.attr("data-code");$.ajax({url:"flooring-sqm-calculation/scripts/delete-flooring-sqm-calculation-quote-item-fitting-charge.php",
type:"POST",dataType:"json",data:{cid,flooring_sqm_calculation_code:f,flooring_sqm_calculation_quote_item_code:d,fitting_charge_code:h},beforeSend:function(){a.prop("disabled",!1).addClass("field-loader")},success:function(d){if(4===d[0])document.location.replace(d[1]);else if(2===d[0])a.prop("disabled",!1).removeClass("field-loader"),alert(d[1]);else if(1===d[0]){e.remove();c.find('option[data-code="'+h+'"]').show();c.val("");d=b.find(".flooring-sqm-calculation-notes").val().length;var f=b.find(".flooring-sqm-calculation-accessory").length,
g=b.find(".flooring-sqm-calculation-per-meter").length,m=b.find(".flooring-sqm-calculation-fitting-charge").length;d||f||g||m?b.find(".flooring-sqm-calculation-table-more-bttn").addClass("red"):b.find(".flooring-sqm-calculation-table-more-bttn").removeClass("red");a.prop("disabled",!1).removeClass("field-loader");$("#getsum").load("getsum.php?cid="+cid).fadeIn("fast");$("#totalx").load("megaTotal.php?cid="+cid).fadeIn("fast")}else a.prop("disabled",!1).removeClass("field-loader"),alert(JSON.stringify(d))},
error:function(b,c,d){a.prop("disabled",!1).removeClass("field-loader");alert(JSON.stringify(b));alert("Error! @delete-flooring-sqm-calculation-quote-item-fitting-charge")}})});$(document).on("submit","#flooring-sqm-calculation-quote-items-results .group-discount-form",function(a){a.preventDefault();var b=$(this),c=$(this).find("input[type='submit']");a=isNaN(b.find(".group-discount").val())?"0":b.find(".group-discount").val();var e=isNaN(b.find(".group-total").val())?"0":b.find(".group-total").val(),
f=b.find(".flooring-sqm-calculation-code").val(),d=(e-e*a/100).toFixed(2);$.ajax({url:"flooring-sqm-calculation/scripts/update-flooring-sqm-calculation-group-discount.php",type:"POST",dataType:"json",data:{cid,discount:a,flooring_sqm_calculation_code:f},beforeSend:function(){c.prop("disabled",!1).addClass("field-loader")},success:function(a){4===a[0]?document.location.replace(a[1]):2===a[0]?(c.prop("disabled",!1).removeClass("field-loader"),alert(a[1])):1===a[0]?(b.siblings(".group-discount-total").html(d),
c.prop("disabled",!1).removeClass("field-loader")):(c.prop("disabled",!1).removeClass("field-loader"),alert(JSON.stringify(a)));$("#getsum").load("getsum.php?cid="+cid).fadeIn("fast");$("#totalx").load("megaTotal.php?cid="+cid).fadeIn("fast")},error:function(a,b,d){c.prop("disabled",!1).removeClass("field-loader");alert(JSON.stringify(a));alert("Error! @update-flooring-sqm-calculation-group-discount")}})})});