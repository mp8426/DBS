$(function(){function r(a){var b=$(a).parents("form"),c=b.find(".twc-calculation-price"),d=b.find(".twc-calculation-field");a=b.find(".twc-calculation-code").val();var g=b.find(".twc-calculation-type").val().split("<->")[1],e=b.find(".twc-calculation-width").val();b=b.find(".twc-calculation-drop").val();a&&g&&e&&b&&(u=$.ajax({url:"twc-calculation/scripts/get-twc-calculation-price.php",type:"POST",dataType:"json",data:{width:e,drop:b,type_code:g,code:a},success:function(b){var a=0;$.each(d,function(){var b=
$(this).val().split("<->")[2];a+=0<b?+b:0});a+=+b;b=a.toFixed(2);c.val(b);0===a?c.attr("title","No Price Available").addClass("tooltip-active").tooltip({content:"No Price Available",tooltipClass:"min_max_dimensions",position:{my:"center top+7",at:"center bottom",collision:"flipfit"},show:{effect:"bounce",delay:1}}).tooltip("close").tooltip("open").off("mouseout mouseover focusout mouseleave"):c.tooltip().tooltip("close").tooltip("destroy").removeAttr("title").removeClass("tooltip-active")},error:function(b,
a,c){alert("Error! @get-twc-calculation-price")}}))}function w(a){a=$(a).parents("form");var b=+a.find(".twc-calculation-width").val(),c=a.find(".twc-calculation-material");c.val("");c.find("option").not(":first").remove();var d=a.find(".twc-calculation-colour");d.val("");d.find("option").not(":first").remove();(a=a.find(".twc-calculation-type").find("option:selected").attr("data-materials-and-colours"))&&$.each(JSON.parse(a),function(a,d){a=+d.max_width;var f=JSON.stringify(d.colours);a>=b&&c.append('<option value="'+
d.name+"<->"+d.code+'" data-code="'+d.code+"\" data-colours='"+f+"'>"+d.name+"</option>")})}function x(a){var b=$(a).parents("form"),c=b.find(".twc-calculation-colour");c.val("");c.find("option").not(":first").remove();b=b.find(".twc-calculation-type option:selected").attr("data-code");var d=$(a).find("option:selected").attr("data-code");if(a=$(a).find("option:selected").attr("data-colours"))$.each(JSON.parse(a),function(b,a){c.append('<option value="'+a.name+"<->"+a.code+'">'+a.name+"</option>")}),
c.append('<option class="twc-calculation-add-colour-option" data-material-code="'+d+'" data-type-code="'+b+'" value="add-new">Add New</option>')}function E(a,b,c,d){d=$(d).parents("form");var g=d.find(".twc-calculation-type"),e=d.find(".twc-calculation-material"),f=d.find(".twc-calculation-colour"),k=d.find(".twc-calculation-add-colour-wrapper"),l=d.find(".twc-calculation-add-colour"),h=d.find(".twc-calculation-add-colour-submit"),p=d.find(".data-field, .number-input, select, [type='submit']"),q=
JSON.parse(g.find("option:selected").attr("data-materials-and-colours")),t=JSON.parse(e.find("option:selected").attr("data-colours"));b&&c&&$.ajax({url:"twc-calculation/scripts/add-twc-calculation-colour.php",type:"POST",dataType:"json",data:{material_code:b,colour_name:c},beforeSend:function(){l.prop("disabled",!0).addClass("field-loader");h.prop("disabled",!0).addClass("field-loader")},success:function(c){4===c[0]?document.location.replace(c[1]):2===c[0]?alert(c[1]):1===c[0]?($.each(q,function(d,
f){f.code===b&&(f.colours.push({code:c[1],name:c[2]}),q.colours=f.colours,$(".twc-calculation-type option[data-code="+a+"]").attr("data-materials-and-colours",JSON.stringify(q)))}),t.push({code:c[1],name:c[2]}),$(".twc-calculation-material option[data-code="+b+"]").attr("data-colours",JSON.stringify(t)),$(".twc-calculation-add-colour-option[data-material-code="+b+"][data-type-code="+a+"]").before('<option value="'+c[2]+"<->"+c[1]+'">'+c[2]+"</option>"),l.removeAttr("data-material-code").val(""),k.hide(),
p.prop("disabled",!1),f.show().val(c[2]+"<->"+c[1]).change()):alert(c);l.prop("disabled",!1).removeClass("field-loader");h.prop("disabled",!1).removeClass("field-loader")},error:function(a,b,c){l.prop("disabled",!1).removeClass("field-loader");h.prop("disabled",!1).removeClass("field-loader")}})}function F(a,b){b=$(b);var c=b.parents("form"),d=b.parents(".twc-calculation-add-field-option-wrapper"),g=d.find(".twc-calculation-add-field-option"),e=d.find(".twc-calculation-add-field-option-submit"),f=
d.siblings(".twc-calculation-field"),k=f.attr("data-code");b=c.find(".twc-calculation-code").val();var l=c.find(".data-field, .number-input, select, [type='submit']");a&&$.ajax({url:"twc-calculation/scripts/add-twc-calculation-field-option.php",type:"POST",dataType:"json",data:{field_code:k,field_option_name:a,twc_calculation_code:b},beforeSend:function(){g.prop("disabled",!0).addClass("field-loader");e.prop("disabled",!0).addClass("field-loader")},success:function(a){if(4===a[0])document.location.replace(a[1]);
else if(2===a[0])alert(a[1]);else if(1===a[0]){$(".twc-calculation-add-field-option-x[data-field-code="+k+"]").before('<option value="'+a[2]+"<->"+a[1]+'<->0.00">'+a[2]+"</option>");var b=c.find(".checkbox-input"),h=c.parents(".twc-calculation-quote-items-body").find(".checkbox-input:checked");b.is(":checked")&&h.length&&h.not(b).each(function(){$(this).parents(".update-twc-calculation-quote-item-form").find(".data-field, .number-input, select, [type='submit']").prop("disabled",!1)});g.val("");d.hide();
l.prop("disabled",!1);f.show().val(a[2]+"<->"+a[1]+"<->0.00").change()}else alert(a);g.prop("disabled",!1).removeClass("field-loader");e.prop("disabled",!1).removeClass("field-loader")},error:function(a,b,c){g.prop("disabled",!1).removeClass("field-loader");e.prop("disabled",!1).removeClass("field-loader")}})}function n(a){a=$(a).parents(".twc-calculation-quote-items-wrapper");var b=a.find(".twc-calculation-quote-items-body").find("input[name='price']:not(:hidden)"),c=$.isNumeric(+a.find(".group-discount").val())?
+a.find(".group-discount").val():0,d=0;b.each(function(){d+=Number($(this).val().replace(/,/g,""))});b=d-d*c/100;a.find(".group-total").val(d.toFixed(2)).end().find(".group-discount").val(c).end().find(".group-discount-total").html(b.toFixed(2)).end().find(".group-discount-form").submit()}function m(a,b){var c=$(a);if("add-new"===c.val())return!1;var d=c.parents(".update-twc-calculation-quote-item-form"),g=d.find(".checkbox-input"),e=d.parents(".twc-calculation-quote-items-body").find(".checkbox-input:checked");
$.ajax({url:"twc-calculation/scripts/update-twc-calculation-quote-item.php",type:"POST",dataType:"json",data:{quote_items_array:b},beforeSend:function(){},success:function(a){if(4===a[0])document.location.replace(a[1]);else if(2===a[0])c.removeClass("field-loader"),alert(a[1]);else if(1===a[0]){if(g.is(":checked")&&e.length)e.each(function(){var a=$(this).parents(".update-twc-calculation-quote-item-form"),b=a.find(".twc-calculation-notes").val().length,c=a.find(".twc-calculation-accessory").length,
d=a.find(".twc-calculation-per-meter").length,f=a.find(".twc-calculation-fitting-charge").length;b||c||d||f?a.find(".twc-calculation-table-more-bttn").addClass("red"):a.find(".twc-calculation-table-more-bttn").removeClass("red")});else{a=d.find(".twc-calculation-notes").val().length;var b=d.find(".twc-calculation-accessory").length,f=d.find(".twc-calculation-per-meter").length,h=d.find(".twc-calculation-fitting-charge").length;a||b||f||h?d.find(".twc-calculation-table-more-bttn").addClass("red"):
d.find(".twc-calculation-table-more-bttn").removeClass("red")}c.removeClass("field-loader");n(d)}else c.removeClass("field-loader"),alert(JSON.stringify(a))},error:function(a,b,d){c.removeClass("field-loader");alert(JSON.stringify(a));alert("Error! @update-twc-calculation-quote-item")}})}$.ajax({url:"twc-calculation/scripts/get-twc-calculations.php",type:"POST",dataType:"json",data:{cid},beforeSend:function(){},success:function(a){4===a[0]?document.location.replace(a[1]):2===a[0]?alert(a[1]):1===
a[0]?($.each(a[1],function(b,c){var d=c.code;if(1===c.location_select){b="<th>Locations</th>";var g="";$.each(a[2],function(a,b){g+='<option value="'+b.name+"<->"+b.code+'">'+b.name+"</option>"});var e='<td>\n                                                    <select name="location" data-column="location" class="twc-calculation-location data-field">\n                                                        <option value=""></option>\n                                                        '+g+"                                                    </select>\n                                                </td>"}else e=
g=b="";var f="",k="";$.each(c.types,function(a,b){a=JSON.stringify(b.min_max_dimensions);var c=JSON.stringify(b.materials_and_colours);f+='<option value="'+b.name+"<->"+b.code+"\" data-materials-and-colours='"+c+"' data-min-max-dimensions='"+a+"' data-code=\""+b.code+'">'+b.name+"</option>"});k='<td>\n                                        <select name="type" data-column="type" class="twc-calculation-type data-field approved-disabled">\n                                            <option value=""></option>\n                                            '+
f+"                                        </select>\n                                    </td>";if(1===c.materials_and_colour_select)var l="<th>Materials</th>",h='<td>\n                                                    <select name="material" data-column="material" class="twc-calculation-material data-field approved-disabled">\n                                                        <option value=""></option>\n                                                    </select>\n                                                </td>',
p="<th>Colours</th>",q='<td>\n                                                    <select name="colour" data-column="colour" class="twc-calculation-colour data-field approved-disabled">\n                                                        <option value=""></option>\n                                                    </select>\n                                                    <span class="twc-calculation-add-colour-wrapper">\n                                                        <input type="text" class="twc-calculation-add-colour text-input">\n                                                        <input type="button" class="twc-calculation-add-colour-submit bttn-input" value="\u271a">\n                                                        <input type="button" class="twc-calculation-add-colour-close bttn-input" value="\u2716">\n                                                    </span>\n                                                </td>';
else q=h=p=l="";var t="",y="",A="",z="";$.each(c.fields,function(a,b){if(1===b.side)if(t+="<th>"+b.name+"</th>",0===b.field_type){var c="";$.each(b.options,function(b,a){c+='<option value="'+a.name+"<->"+a.code+"<->"+a.price+'">'+a.name+(0<a.price?" | "+a.price:"")+"</option>"});c+='<option class="twc-calculation-add-field-option-x" data-field-code="'+b.code+'" value="add-new">Add New</option>';y+='<td>\n                                                        <select name="field['+b.code+']" data-code="'+
b.code+'" data-column="field-'+b.code+'" class="twc-calculation-field data-field">\n                                                            <option value=""></option>\n                                                            '+c+'                                                        </select>\n                                                        <span class="twc-calculation-add-field-option-wrapper">\n                                                            <input type="text" class="twc-calculation-add-field-option text-input">\n                                                            <input type="button" class="twc-calculation-add-field-option-submit bttn-input" value="\u271a">\n                                                            <input type="button" class="twc-calculation-add-field-option-close bttn-input" value="\u2716">\n                                                        </span>\n                                                    </td>'}else y+=
'<td>\n                                                        <input type="text" name="field['+b.code+']" data-code="'+b.code+'" data-column="field-'+b.code+'" class="twc-calculation-field data-field text-field" autocomplete="off">\n                                                    </td>';0===b.side&&(A+="<th>"+b.name+"</th>",0===b.field_type?(c="",$.each(b.options,function(b,a){c+='<option value="'+a.name+"<->"+a.code+"<->"+a.price+'">'+a.name+(0<a.price?" | "+a.price:"")+"</option>"}),c+='<option class="twc-calculation-add-field-option-x" data-field-code="'+
b.code+'" value="add-new">Add New</option>',z+='<td>\n                                                            <select name="field['+b.code+']" data-code="'+b.code+'" data-column="field-'+b.code+'" class="twc-calculation-field data-field">\n                                                                <option value=""></option>\n                                                                '+c+'                                                            </select>\n                                                            <span class="twc-calculation-add-field-option-wrapper">\n                                                                <input type="text" class="twc-calculation-add-field-option text-input">\n                                                                <input type="button" class="twc-calculation-add-field-option-submit bttn-input" value="\u271a">\n                                                                <input type="button" class="twc-calculation-add-field-option-close bttn-input" value="\u2716">\n                                                            </span>\n                                                        </td>'):
z+='<td>\n                                                            <input type="text" name="field['+b.code+']" data-code="'+b.code+'" data-column="field-'+b.code+'" class="twc-calculation-field data-field text-field" autocomplete="off">\n                                                        </td>')});if(1===c.accessories_select){var m="",G="",n='<input type="hidden" class="accessory-option-array" value=\''+JSON.stringify(c.accessory_options)+"'>";$.each(c.accessory_options,function(a,b){G+='<option data-code="'+
b.code+'" value="'+b.code+"<->"+b.name+"<->"+b.price+'">'+b.name+" | "+b.price+"</option>"});m='<span class="twc-calculation-accessories-wrapper">\n                                                <select class="twc-calculation-accessories">\n                                                    <option value="">Accessories</option>\n                                                    '+G+'                                                </select>\n                                                <input type="tel" class="add-twc-calculation-accessory-qty qty-input" placeholder="Qty">\n                                                <input type="button" class="add-twc-calculation-accessories bttn-input" value="\u271a">\n                                            </span>'}else n=
m="";if(1===c.per_meters_select){var B="",H="",I='<input type="hidden" class="per-meter-option-array" value=\''+JSON.stringify(c.per_meter_options)+"'>";$.each(c.per_meter_options,function(b,a){H+='<option data-code="'+a.code+'" value="'+a.code+"<->"+a.name+"<->"+a.price+'">'+a.name+" | "+a.price+"</option>"});B='<span class="twc-calculation-accessories-wrapper">\n                                                <select class="twc-calculation-per-meters">\n                                                    <option value="">Per Meters</option>\n                                                    '+
H+'                                                </select>\n                                                <input type="tel" class="add-twc-calculation-per-meter-width qty-input" placeholder="Width">\n                                                <input type="button" class="add-twc-calculation-per-meters bttn-input" value="\u271a">\n                                            </span>'}else I=B="";if(1===c.fitting_charges_select){var C="",J="",r='<input type="hidden" class="fitting-charge-option-array" value=\''+
JSON.stringify(c.fitting_charge_options)+"'>";$.each(c.fitting_charge_options,function(a,b){J+='<option data-code="'+b.code+'" value="'+b.code+"<->"+b.name+"<->"+b.price+'">'+b.name+" | "+b.price+"</option>"});C='<span class="twc-calculation-fitting-charges-wrapper">\n                                                    <select class="twc-calculation-fitting-charges">\n                                                        <option value="">Fitting Charges</option>\n                                                        '+
J+'                                                    </select>\n                                                    <input type="button" class="add-twc-calculation-fitting-charges bttn-input" value="\u271a">\n                                                </span>'}else r=C="";1===c.status&&($('<li><a href="#tab-'+c.code+'">'+c.name+"</a></li>").prependTo("#twc-calculation-tabs .tabs ul"),$('<div id="tab-'+c.code+'" class="twc-calculation-tab-div"></div>').append($('<form class="add-twc-calculation-quote-item-form" action="./" method="POST"></form>').append('<input type="hidden" class="cid" name="cid" value="'+
cid+'">').append('<input type="hidden" class="twc-calculation-code" name="twc-calculation-code" value="'+d+'">').append($('<table class="twc-calculation-table"></table>').append($('<thead class="thead"></thead>').append($('<tr class="thead-tr"></tr>').append(t).append(b).append("<th>Width</th>").append("<th>Height</th>").append("<th>Types</th>").append(l).append(p).append(A).append('<th>\n                                                        <table class="right-fixed-column">\n                                                            <tr>\n                                                                <th>Price</th>\n                                                                <th>Qty</th>\n                                                                <th>Add</th>\n                                                            </tr>\n                                                        </table>\n                                                    </th>'))).append($("<tbody></tbody>").append($('<tr class="tbody-tr"></tr>').append(y).append(e).append('<td><input type="tel" name="width" data-column="width_x" class="twc-calculation-width number-input data-field" maxlength="4" autocomplete="off" min="0" placeholder="mm"></td>').append('<td><input type="tel" name="drop" data-column="drop_x" class="twc-calculation-drop number-input data-field" maxlength="4" autocomplete="off" min="0" placeholder="mm"></td>').append(k).append(h).append(q).append(z).append('<td>\n                                                                            <table class="right-fixed-column" style="margin-top: -20px;">\n                                                                                <tr>\n                                                                                    <td><input type="tel" name="price" class="twc-calculation-price price-input data-field" autocomplete="off"></td>\n                                                                                    <td><input type="number" name="qty" class="twc-calculation-qty number-input" autocomplete="off" min="1" value="1"></td>\n                                                                                    <td><input type="submit" class="bttn-input" value="\u271a"></td>\n                                                                                </tr>\n                                                                            </table>\n                                                                        </td>')))).append(n).append(I).append(r)).prependTo("#twc-calculation-tabs .calculation-results").find(".bttn-input").button());
if("[]"!==JSON.stringify(c.quote_items)){$('<div id="twc-calculation-quote-items-wrapper-'+d+'" class="twc-calculation-quote-items-wrapper"></div>').append('<h2 class="twc-calculation-header">'+c.name+"</h2>").append('<div id="quote-items-body-'+d+'" class="twc-calculation-quote-items-body"></div>').append('<div class="bulk-action-button-wrapper">\n                                            <input type="button" class="bulk-action-button twc-calculation-select-all-bttn" value="\u2714">\n                                            <input type="button" class="bulk-action-button twc-calculation-bulk-delete-bttn" value="Delete">\n                                            <input type="button" class="bulk-action-button twc-calculation-bulk-copy-bttn" value="Copy">\n                                            <a href="print/order-sheet-twc-calculation-'+
d+"-"+cid+'" target="_blank" class="bulk-action-button print-bttn" style="width: 145px;">Print Order Sheet</a>\n                                            <a href="https://file-gen.blinq.com.au/clients/'+user_account+"/order-sheet-xlsx-twc-calculation-"+d+"-"+cid+'" target="_blank" class="bulk-action-button print-bttn" style="width: 175px;">Print Order Sheet Xlsx</a>\n                                            <form class="group-discount-form" style="float: right; margin-right: -6px; font-size: 12px;">\n                                                <input type="tel" class="group-total price-input ui-state-default" autocomplete="off" style="float: left;" disabled>\n                                                <input type="tel" class="group-discount price-input ui-state-default" autocomplete="off" placeholder="%" style="float: left; margin-left: 1px !important; margin-right: 1px !important; text-align: center; width: 33px;" required>\n                                                <input type="hidden" class="twc-calculation-code" value="'+
d+'">\n                                                <input type="submit" class="bttn-input ui-button ui-widget ui-state-default ui-corner-all" value="\u2714" role="button" aria-disabled="false" style="float: left;">\n                                            </form>\n                                            <div class="group-discount-total" style="float: right; line-height: 40px; margin-right: 400px; font-size: 22px; font-weight: bold;"></div>\n                                        </div>').prependTo("#twc-calculation-quote-items-results").find(".bttn-input, .bulk-action-button").button();
b='<tr class="thead-tr">\n                                                <th class="left-fixed-column">#</th>\n                                                '+t+"                                                "+b+"                                                <th>Width</th>\n                                                <th>Height</th>\n                                                <th>Types</th>                                                "+l+"                                                "+
p+"                                                "+A+'                                                <th>\n                                                    <table class="right-fixed-column">\n                                                        <tr>\n                                                            <th>Price</th>\n                                                            <th>More</th>\n                                                            <th>Del</th>\n                                                        </tr>\n                                                    </table>\n                                                </th>\n                                            </tr>';
var u=1,v=0,D=0;$.each(c.quote_items,function(b,a){$('<form id="calculation-form-'+a.code+'" class="update-twc-calculation-quote-item-form" action="./" method="POST">\n                                    <input type="hidden" name="cid" class="cid" value="'+cid+'">\n                                    <input type="hidden" name="twc-calculation-code" class="twc-calculation-code" value="'+d+'">\n                                    <input type="hidden" name="twc-calculation-quote-item-code" class="twc-calculation-quote-item-code" value="'+
a.code+'">\n                                    <table class="twc-calculation-table">\n                                        <thead class="thead"></thead>\n                                        <tbody>\n                                            <tr>\n                                                <td class="left-fixed-column">\n                                                    <label class="checkbox-label" for="checkbox-'+a.code+'">'+u+'</label>\n                                                    <input type="checkbox" id="checkbox-'+
a.code+'"class="checkbox-input" name="quote-item-codes[]" value="'+a.code+'">\n                                                </td>\n                                                '+y+"                                                "+e+'                                                <td><input type="tel" name="width" data-column="width_x" class="twc-calculation-width number-input data-field" maxlength="4" autocomplete="off" min="0" value="'+a.width+'" placeholder="mm"></td>\n                                                <td><input type="tel" name="drop" data-column="drop_x" class="twc-calculation-drop number-input data-field" maxlength="4" autocomplete="off" min="0" value="'+
a.drop+'" placeholder="mm"></td>\n                                                '+k+"                                                "+h+"                                                "+q+"                                                "+z+'                                                <td>\n                                                    <table class="right-fixed-column" style="margin-top: -20px;">\n                                                        <tr>\n                                                            <td><input type="tel" name="price" data-column="price" class="twc-calculation-price price-input data-field ui-state-default" autocomplete="off" value="'+
a.price+'"></td>\n                                                            <td><input type="button" class="twc-calculation-table-more-bttn bttn-input" value="\u2605"></td>\n                                                            <td><input type="button" class="bttn-input delete-twc-calculation-quote-item" value="\u2716"></td>\n                                                        </tr>\n                                                    </table>\n                                                </td>\n                                            </tr>\n                                        </tbody>\n                                    </table>\n                                    <table id="calculation-table-more-'+
a.code+'"  class="twc-calculation-table-more">\n                                        <tr>\n                                            <td class="table-more-notes" colspan="3">\n                                                <textarea name="notes" data-column="notes" class="twc-calculation-notes data-field" placeholder="Notes">'+a.notes+'</textarea>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td class="table-more-accessories">\n                                                '+
m+'                                            </td>\n                                            <td class="table-more-per-meters">\n                                                '+B+'                                            </td>\n                                            <td class="table-more-fitting-charges">\n                                                '+C+"                                            </td>\n                                        </tr>\n                                    </table>\n                                </form>").appendTo("#quote-items-body-"+
d).queue(function(){var b=$(this);b.find("[name='location']").val(a.location);b.find("[name='type']").val(a.type).queue(function(){w(this);$(this).dequeue()});b.find("[name='material']").val(a.material).queue(function(){x(this);$(this).dequeue()});b.find("[name='colour']").val(a.colour);"1"===quote_status&&b.find(".approved-disabled").css({"pointer-events":"none",background:"#f2f2f2"});$.each(a.fields,function(a,c){a=c.code;var d=c.name,f=c.price;c=c.twc_calculation_field_code;b.find("[name='field["+
c+"]']").is("input")?b.find("[name='field["+c+"]']").val(d):b.find("[name='field["+c+"]']").val(d+"<->"+a+"<->"+f)});$.each(a.accessories,function(a,c){a=c.code;var d=c.name,f=+c.price;c=+c.qty;var e=(f*c).toFixed(2);b.find(".table-more-accessories").append('<span class="twc-calculation-accessories-wrapper">\n                                                                                            <input type="text" class="twc-calculation-accessory" readonly disabled value="'+d+" | "+f+" x "+c+
" = "+e+'">\n                                                                                            <input type="button" class="delete-twc-calculation-accessory bttn-input" data-code="'+a+'" value="\u2716">\n                                                                                        </span>');b.find('.twc-calculation-accessories option[data-code="'+a+'"]').hide()});$.each(a.per_meters,function(a,c){a=c.code;var d=c.name,f=+c.price;c=+c.width;var e=(f*c).toFixed(2);b.find(".table-more-per-meters").append('<span class="twc-calculation-per-meters-wrapper">\n                                                                                            <input type="text" class="twc-calculation-per-meter" readonly disabled value="'+
d+" | "+f+" x "+c+" = "+e+'">\n                                                                                            <input type="button" class="delete-twc-calculation-per-meter bttn-input" data-code="'+a+'" value="\u2716">\n                                                                                        </span>');b.find('.twc-calculation-per-meters option[data-code="'+a+'"]').hide()});$.each(a.fitting_charges,function(a,c){a=c.code;var d=c.name;c=c.price;b.find(".table-more-fitting-charges").append('<span class="twc-calculation-fitting-charges-wrapper">\n                                                                                                <input type="text" class="twc-calculation-fitting-charge" readonly disabled value="'+
d+" | "+c+'">\n                                                                                                <input type="button" class="delete-twc-calculation-fitting-charge bttn-input" data-code="'+a+'" value="\u2716">\n                                                                                            </span>');b.find('.twc-calculation-fitting-charges option[data-code="'+a+'"]').hide()});var c=a.notes,d=b.find(".twc-calculation-accessory").length,f=b.find(".twc-calculation-per-meter").length,
e=b.find(".twc-calculation-fitting-charge").length;c||d||f||e?b.find(".twc-calculation-table-more-bttn").addClass("red"):b.find(".twc-calculation-table-more-bttn").removeClass("red");u++;v=+v+ +a.price;D=a.discount;b.find(".bttn-input, .checkbox-input").button();b.dequeue()}).clearQueue().html()});$("#twc-calculation-quote-items-wrapper-"+d).find(".group-total").val(v.toFixed(2)).end().find(".group-discount").val(D).end().find(".group-discount-total").html((v-v*D/100).toFixed(2));$(".twc-calculation-quote-items-body .twc-calculation-table .thead").first().html(b)}else $('<div id="twc-calculation-quote-items-wrapper-'+
d+'" class="twc-calculation-quote-items-wrapper"></div>').append('<h2 class="twc-calculation-header">'+c.name+"</h2>").append('<div id="quote-items-body-'+d+'" class="twc-calculation-quote-items-body"></div>').append('<div class="bulk-action-button-wrapper"></div>').prependTo("#twc-calculation-quote-items-results").hide()}),$(".tabs").tabs("refresh").tabs("option","active",0)):alert(JSON.stringify(a))},error:function(a,b,c){alert(JSON.stringify(a))}});$(document).on("click",".twc-calculation-select-all-bttn",
function(){var a=$(this),b=a.val(),c=a.parents(".twc-calculation-quote-items-wrapper");"\u2714"===b?(c.find(".checkbox-input").prop("checked",!0).change().button("refresh"),a.val("\u2716")):(c.find(".checkbox-input").prop("checked",!1).change().button("refresh"),a.val("\u2714"))});$(document).on("click",".twc-calculation-bulk-delete-bttn",function(){var a=$(this),b=a.parents(".twc-calculation-quote-items-wrapper"),c=b.find(".twc-calculation-table .thead .thead-tr").clone(),d=b.find(".checkbox-input:checked"),
g=d.serialize()+"&cid="+cid;g&&$.ajax({url:"twc-calculation/scripts/delete-bulk-twc-calculation-quote-items.php",type:"POST",dataType:"json",data:g,beforeSend:function(){a.prop("disabled",!1).addClass("field-loader")},success:function(e){4===e[0]?document.location.replace(e[1]):2===e[0]?(a.prop("disabled",!1).removeClass("field-loader"),alert(e[1])):1===e[0]?($.each(d.serializeArray(),function(a,b){$("#calculation-form-"+b.value).remove()}),b.find(".update-twc-calculation-quote-item-form").length?
(b.find(".checkbox-label").each(function(a){$(this).find(".ui-button-text").html(a+1)}),b.find(".twc-calculation-table .thead").first().html(c)):b.hide().find(".bulk-action-button-wrapper").empty(),a.prop("disabled",!1).removeClass("field-loader"),n(a),$("#getsum").load("getsum.php?cid="+cid).fadeIn("fast"),$("#totalx").load("megaTotal.php?cid="+cid).fadeIn("fast")):(a.prop("disabled",!1).removeClass("field-loader"),alert(JSON.stringify(e)))},error:function(b,c,d){a.prop("disabled",!1).removeClass("field-loader");
alert(JSON.stringify(b));alert("Error! @delete-bulk-twc-calculation-quote-item")}})});$(document).on("click",".twc-calculation-bulk-copy-bttn",function(){var a=$(this),b=a.parents(".twc-calculation-quote-items-wrapper"),c=b.find(".checkbox-input:checked").serialize()+"&cid="+cid;c&&$.ajax({url:"twc-calculation/scripts/copy-bulk-twc-calculation-quote-items.php",type:"POST",dataType:"json",data:c,beforeSend:function(){a.prop("disabled",!1).addClass("field-loader")},success:function(c){4===c[0]?document.location.replace(c[1]):
2===c[0]?(a.prop("disabled",!1).removeClass("field-loader"),alert(c[1])):1===c[0]?($.each(c[1],function(a,c){var d=$("#calculation-form-"+a).clone();d.attr("id","calculation-form-"+c);d.find(".twc-calculation-quote-item-code").val(c);d.find(".checkbox-label").attr("for","checkbox-"+c);d.find(".checkbox-input").attr("id","checkbox-"+c).val(c);d.find(".checkbox-input").button();d.find(".twc-calculation-table-more").attr("id","calculation-table-more-"+c).hide();d.find(".twc-calculation-table .thead").empty();
$(d).appendTo(b.find(".twc-calculation-quote-items-body")).queue(function(){var b=$(this),c=$("#calculation-form-"+a);$.each(c.serializeArray(),function(a,c){b.find(".data-field[name='"+c.name+"']").val(c.value)});b.dequeue()}).clearQueue()}),b.find(".checkbox-label").each(function(a){$(this).find(".ui-button-text").html(a+1)}),a.prop("disabled",!1).removeClass("field-loader"),n(a)):(a.prop("disabled",!1).removeClass("field-loader"),alert(JSON.stringify(c)))},error:function(b,c,e){a.prop("disabled",
!1).removeClass("field-loader");alert(JSON.stringify(b));alert("Error! @copy-bulk-twc-calculation-quote-item")}})});$(document).on("click",".delete-twc-calculation-quote-item",function(){var a=$(this),b=a.parents(".update-twc-calculation-quote-item-form"),c=b.find(".twc-calculation-quote-item-code").val(),d=b.parents(".twc-calculation-quote-items-wrapper"),g=d.find(".twc-calculation-table .thead .thead-tr").clone();$.ajax({url:"twc-calculation/scripts/delete-twc-calculation-quote-item.php",type:"POST",
dataType:"json",data:{cid,code:c},beforeSend:function(){a.prop("disabled",!0).addClass("field-loader")},success:function(c){4===c[0]?document.location.replace(c[1]):2===c[0]?(a.prop("disabled",!1).removeClass("field-loader"),alert(c[1])):1===c[0]?(b.hide(),d.find(".twc-calculation-table .thead").first().html(g),a.prop("disabled",!1).removeClass("field-loader"),n(b),$("#getsum").load("getsum.php?cid="+cid).fadeIn("fast"),$("#totalx").load("megaTotal.php?cid="+cid).fadeIn("fast"),b.remove(),d.find(".update-twc-calculation-quote-item-form").length?
d.find(".checkbox-label").each(function(a){$(this).find(".ui-button-text").html(a+1)}):d.hide().find(".bulk-action-button-wrapper").empty()):(a.prop("disabled",!1).removeClass("field-loader"),alert(JSON.stringify(c)))},error:function(b,c,d){a.prop("disabled",!1).removeClass("field-loader");alert(JSON.stringify(b));alert("Error! @delete-twc-calculation-quote-item")}})});$(document).on("click",".twc-calculation-table-more-bttn",function(){$(this).parents("form").find(".twc-calculation-table-more").toggle("slide",
{direction:"up"},"fast")});$(document).on("change",".checkbox-input",function(){var a=$(this),b=a.parents(".twc-calculation-table");a.is(":checked")?b.find("select, .number-input, .text-field").addClass("ui-state-default"):b.find("select, .number-input, .text-field").removeClass("ui-state-default")});$(document).on("change",".add-twc-calculation-quote-item-form .twc-calculation-width,\n                                .add-twc-calculation-quote-item-form .twc-calculation-drop,\n                                .add-twc-calculation-quote-item-form .twc-calculation-type,\n                                .add-twc-calculation-quote-item-form .twc-calculation-field",
function(){var a=$(this).parents("form"),b=a.find(".twc-calculation-width"),c=a.find(".twc-calculation-drop");a=a.find(".twc-calculation-type");b.tooltip();c.tooltip();if(a.val()){var d=JSON.parse(a.find("option:selected").attr("data-min-max-dimensions"));a=d.max_width;d=d.max_drop;var g=b.val(),e=c.val();a<g?(a="Max Width: "+a,b.attr("title",a).addClass("tooltip-active").tooltip({content:a,tooltipClass:"min_max_dimensions",position:{my:"center top+7",at:"center bottom",collision:"flipfit"},show:{effect:"bounce",
delay:1}}).tooltip("close").tooltip("open").off("mouseout mouseover focusout mouseleave"),c.tooltip("close").tooltip("destroy").removeAttr("title").removeClass("tooltip-active")):(d<e?(a="Max Height: "+d,c.attr("title",a).addClass("tooltip-active").tooltip({content:a,tooltipClass:"min_max_dimensions",position:{my:"center top+7",at:"center bottom",collision:"flipfit"},show:{effect:"bounce",delay:1}}).tooltip("close").tooltip("open").off("mouseout mouseover focusout mouseleave")):c.tooltip("close").tooltip("destroy").removeAttr("title").removeClass("tooltip-active"),
b.tooltip("close").tooltip("destroy").removeAttr("title").removeClass("tooltip-active"))}else c.tooltip("close").tooltip("destroy").removeAttr("title").removeClass("tooltip-active"),b.tooltip("close").tooltip("destroy").removeAttr("title").removeClass("tooltip-active");r(this)});var u="";$(document).on("change",".twc-calculation-width, .twc-calculation-type",function(){("1"!==quote_status||$(this).parents("form").hasClass("add-twc-calculation-quote-item-form"))&&w(this)});$(document).on("change",
".twc-calculation-material",function(){("1"!==quote_status||$(this).parents("form").hasClass("add-twc-calculation-quote-item-form"))&&x(this)});$(document).on("change",".twc-calculation-colour",function(a){a=$(this);var b=a.parents("form"),c=b.find(".twc-calculation-add-colour-wrapper"),d=b.find(".twc-calculation-add-colour");b=b.find(".data-field, .number-input, select, [type='submit']");var g=a.find("option:selected").attr("data-type-code"),e=a.find("option:selected").attr("data-material-code");
g&&e&&(a.toggle(),c.toggle(),d.attr({"data-material-code":e,"data-type-code":g}).focus(),b.prop("disabled",!0))});$(document).on("keypress",".twc-calculation-add-colour",function(a){if(13===a.keyCode){a.preventDefault();a=$(this);var b=a.parents("form").find(".twc-calculation-add-colour"),c=b.attr("data-type-code"),d=b.attr("data-material-code");b=b.val();E(c,d,b,a);return!1}});$(document).on("click",".twc-calculation-add-colour-submit",function(a){a.preventDefault();a=$(this);var b=a.parents("form").find(".twc-calculation-add-colour"),
c=b.attr("data-type-code"),d=b.attr("data-material-code");b=b.val();E(c,d,b,a);return!1});$(document).on("click",".twc-calculation-add-colour-close",function(){var a=$(this).parents("form"),b=a.find(".twc-calculation-colour"),c=a.find(".twc-calculation-add-colour-wrapper"),d=a.find(".twc-calculation-add-colour");a=a.find(".data-field, .number-input, select, [type='submit']");b.toggle().val("").change();c.toggle();d.removeAttr("data-material-code").val("");a.prop("disabled",!1)});$(document).on("change",
".twc-calculation-field",function(a){var b=$(this),c=b.parents("form");a=b.siblings(".twc-calculation-add-field-option-wrapper");var d=a.find(".twc-calculation-add-field-option"),g=c.find(".data-field, .number-input, select, [type='submit']"),e=c.find(".checkbox-input");c=c.parents(".twc-calculation-quote-items-body").find(".checkbox-input:checked");e.is(":checked")&&c.length&&c.not(e).each(function(){var a=$(this).parents(".update-twc-calculation-quote-item-form").find(".data-field, .number-input, select, [type='submit']");
"add-new"===b.val()&&a.prop("disabled",!0)});"add-new"===b.val()&&(b.hide(),a.show(),d.focus(),g.prop("disabled",!0))});$(document).on("keypress",".twc-calculation-add-field-option",function(a){if(13===a.keyCode){a.preventDefault();a=$(this);var b=a.parents(".twc-calculation-add-field-option-wrapper").find(".twc-calculation-add-field-option").val();F(b,a);return!1}});$(document).on("click",".twc-calculation-add-field-option-submit",function(a){a.preventDefault();a=$(this);var b=a.siblings(".twc-calculation-add-field-option").val();
F(b,a);return!1});$(document).on("click",".twc-calculation-add-field-option-close",function(){var a=$(this),b=a.parents("form");a=a.parents(".twc-calculation-add-field-option-wrapper");var c=a.find(".twc-calculation-add-field-option"),d=a.siblings(".twc-calculation-field"),g=b.find(".data-field, .number-input, select, [type='submit']"),e=b.find(".checkbox-input");b=b.parents(".twc-calculation-quote-items-body").find(".checkbox-input:checked");e.is(":checked")&&b.length&&b.not(e).each(function(){$(this).parents(".update-twc-calculation-quote-item-form").find(".data-field, .number-input, select, [type='submit']").prop("disabled",
!1)});c.val("");a.hide();g.prop("disabled",!1);d.show().val("").change().focus()});$(document).on("submit",".add-twc-calculation-quote-item-form",function(a){a.preventDefault();var b=$(this),c=b.find('[type="submit"]'),d=b.find(".twc-calculation-table .thead-tr"),g=b.find(".twc-calculation-table .tbody-tr"),e=b.find(".twc-calculation-code").val(),f=b.find(".accessory-option-array").val(),k=b.find(".per-meter-option-array").val(),l=b.find(".fitting-charge-option-array").val(),h=$("#twc-calculation-quote-items-wrapper-"+
e),p=$.isNumeric(+h.find(".group-discount").val())?+h.find(".group-discount").val():0;a=b.serialize();console.log(b.serializeArray());$.ajax({url:"twc-calculation/scripts/add-twc-calculation-quote-item.php",type:"POST",dataType:"json",data:a,beforeSend:function(a){c.prop("disabled",!1).addClass("field-loader")},success:function(a){4===a[0]?document.location.replace(a[1]):2===a[0]?(c.prop("disabled",!1).removeClass("field-loader"),alert(a[1])):1===a[0]?($(b).find(".tooltip-active").tooltip().tooltip("close").tooltip("destroy").removeAttr("title").removeClass("tooltip-active"),
$(b).find(".data-field:first").focus(),$.each(a[1],function(a,c){$("#quote-items-body-"+e+" .twc-calculation-table").length?a="":(a=d.clone(),a.prepend('<th class="left-fixed-column">#</th>'),a.find(".right-fixed-column").html("<tr>\n                                                                                    <th>Price</th>\n                                                                                    <th>More</th>\n                                                                                    <th>Del</th>\n                                                                                </tr>"),
a=a.html(),$("#twc-calculation-quote-items-wrapper-"+e).show());var h=g.clone();h.prepend('<td class="left-fixed-column">\n                                                        <label class="checkbox-label" for="checkbox-'+c+'"></label>\n                                                        <input type="checkbox" id="checkbox-'+c+'" class="checkbox-input" name="quote-item-codes[]" value="'+c+'">\n                                                    </td>');h.find(".right-fixed-column").html('<tr>\n                                                                                <td><input type="tel" name="price" data-column="price" class="twc-calculation-price price-input data-field ui-state-default" autocomplete="off"></td>\n                                                                                <td><input type="button" class="twc-calculation-table-more-bttn bttn-input" value="\u2605"></td>\n                                                                                <td><input type="button" class="bttn-input delete-twc-calculation-quote-item" value="\u2716"></td>\n                                                                            </tr>');
"1"===quote_status&&h.find(".approved-disabled").css({"pointer-events":"none",background:"#f2f2f2"});if(f){var p="",q="";$.each(JSON.parse(f),function(a,b){q+='<option data-code="'+b.code+'" value="'+b.code+"<->"+b.name+"<->"+b.price+'">'+b.name+" | "+b.price+"</option>"});p='<span class="twc-calculation-accessories-wrapper">\n                                                    <select class="twc-calculation-accessories">\n                                                        <option value="">Accessories</option>\n                                                        '+
q+'                                                    </select>\n                                                    <input type="tel" class="add-twc-calculation-accessory-qty qty-input" placeholder="Qty">\n                                                    <input type="button" class="add-twc-calculation-accessories bttn-input" value="\u271a">\n                                                </span>'}else p="";if(k){var m="",t="";$.each(JSON.parse(k),function(a,b){t+='<option data-code="'+b.code+
'" value="'+b.code+"<->"+b.name+"<->"+b.price+'">'+b.name+" | "+b.price+"</option>"});m='<span class="twc-calculation-per-meters-wrapper">\n                                                    <select class="twc-calculation-per-meters">\n                                                        <option value="">Per Meters</option>\n                                                        '+t+'                                                    </select>\n                                                    <input type="tel" class="add-twc-calculation-per-meter-width qty-input" placeholder="Width">\n                                                    <input type="button" class="add-twc-calculation-per-meters bttn-input" value="\u271a">\n                                                </span>'}else m=
"";if(l){var n="",r="";$.each(JSON.parse(l),function(a,b){r+='<option data-code="'+b.code+'" value="'+b.code+"<->"+b.name+"<->"+b.price+'">'+b.name+" | "+b.price+"</option>"});n='<span class="twc-calculation-fitting-charges-wrapper">\n                                                        <select class="twc-calculation-fitting-charges">\n                                                            <option value="">Fitting Charges</option>\n                                                            '+
r+'                                                        </select>\n                                                        <input type="button" class="add-twc-calculation-fitting-charges bttn-input" value="\u271a">\n                                                    </span>'}else n="";$('<form id="calculation-form-'+c+'" class="update-twc-calculation-quote-item-form" action="./" method="POST">\n                                <input type="hidden" name="cid" class="cid" value="'+cid+'">\n                                <input type="hidden" name="twc-calculation-code" class="twc-calculation-code" value="'+
e+'">\n                                <input type="hidden" name="twc-calculation-quote-item-code" class="twc-calculation-quote-item-code" value="'+c+'">\n                                <table class="twc-calculation-table">\n                                    <thead class="thead">\n                                        <tr class="thead-tr">'+a+"</tr>\n                                    </thead>\n                                    <tbody>\n                                        "+h.html()+'                                    </tbody>\n                                </table>\n                                <table id="calculation-table-more-'+
c+'"  class="twc-calculation-table-more">\n                                    <tr>\n                                        <td class="table-more-notes" colspan="3">\n                                            <textarea name="notes" data-column="notes" class="twc-calculation-notes data-field" placeholder="Notes"></textarea>\n                                        </td>\n                                    </tr>\n                                    <tr>\n                                        <td class="table-more-accessories">\n                                            '+
p+'                                        </td>\n                                        <td class="table-more-per-meters">\n                                            '+m+'                                        </td>\n                                        <td class="table-more-fitting-charges">\n                                            '+n+"                                        </td>\n                                    </tr>\n                                </table>\n                            </form>").appendTo("#quote-items-body-"+
e).queue(function(){var a=$(this);$.each(b.serializeArray(),function(b,c){a.find("[name='"+c.name+"']").val(c.value)});a.find(".bttn-input, .checkbox-input").button();a.dequeue()}).clearQueue()}),h.find(".bulk-action-button-wrapper").html('<input type="button" class="bulk-action-button twc-calculation-select-all-bttn" value="\u2714">\n                                                                            <input type="button" class="bulk-action-button twc-calculation-bulk-delete-bttn" value="Delete">\n                                                                            <input type="button" class="bulk-action-button twc-calculation-bulk-copy-bttn" value="Copy">\n                                                                            <a href="print/order-sheet-twc-calculation-'+
e+"-"+cid+'" target="_blank" class="bulk-action-button print-bttn" style="width: 145px;">Print Order Sheet</a>\n                                                                            <a href="https://file-gen.blinq.com.au/clients/'+user_account+"/order-sheet-xlsx-twc-calculation-"+e+"-"+cid+'" target="_blank" class="bulk-action-button print-bttn" style="width: 175px;">Print Order Sheet Xlsx</a>\n                                                                            <form class="group-discount-form" style="float: right; margin-right: -6px; font-size: 12px;">\n                                                                                <input type="tel" class="group-total price-input ui-state-default" autocomplete="off" style="float: left;" disabled value="">\n                                                                                <input type="tel" class="group-discount price-input ui-state-default" autocomplete="off" placeholder="%" value="'+
p+'" style="float: left; margin-left: 1px !important; margin-right: 1px !important; text-align: center; width: 33px;" required value="">\n                                                                                <input type="hidden" class="twc-calculation-code" value="'+e+'">\n                                                                                <input type="submit" class="bttn-input ui-button ui-widget ui-state-default ui-corner-all" value="\u2714" role="button" aria-disabled="false" style="float: left;">\n                                                                            </form>\n                                                                            <div class="group-discount-total" style="float: right; line-height: 40px; margin-right: 400px; font-size: 22px; font-weight: bold;"></div>\n                                                                        ').find(".bulk-action-button").button(),
h.find(".checkbox-label").each(function(a){$(this).find(".ui-button-text").html(a+1)}),b[0].reset(),b.find(".twc-calculation-material").val("").find("option").not(":first").remove(),b.find(".twc-calculation-colour").val("").find("option").not(":first").remove(),c.prop("disabled",!1).removeClass("field-loader"),n(h.find(".group-discount-form"))):(c.prop("disabled",!1).removeClass("field-loader"),alert(JSON.stringify(a)))},error:function(a,b,d){c.prop("disabled",!1).removeClass("field-loader");alert(JSON.stringify(a));
alert("Error! @add-twc-calculation-quote-item")}})});$(document).on("change",".update-twc-calculation-quote-item-form .data-field",function(a){a.preventDefault();var b=$(this),c=b.attr("name"),d=b.val();if("add-new"===d)return!1;b.toggleClass("field-loader");var g=b.parents(".update-twc-calculation-quote-item-form");a=g.find(".checkbox-input");var e=g.parents(".twc-calculation-quote-items-body").find(".checkbox-input:checked"),f="";if(a.is(":checked")&&e.length){f=[];var k=0;e.each(function(){var a=
$(this).parents(".update-twc-calculation-quote-item-form"),h=a.find("[name='"+c+"']");h.val(d);("width"===h.attr("name")||"drop"===h.attr("name")||"type"===h.attr("name")||h.hasClass("twc-calculation-field"))&&"1"!==quote_status&&r(h);"width"!==h.attr("name")&&"type"!==h.attr("name")||"1"===quote_status||w(h);"material"===h.attr("name")&&x(h);"width"===h.attr("name")||"drop"===h.attr("name")||"type"===h.attr("name")||h.hasClass("twc-calculation-field")?"1"!==quote_status?u.done(function(){k+=1;f.push(a.serialize());
e.length===k&&m(b,f)}):(k+=1,f.push(a.serialize()),e.length===k&&m(b,f)):(k+=1,f.push(a.serialize()),e.length===k&&m(b,f))})}else("width"===b.attr("name")||"drop"===b.attr("name")||"type"===b.attr("name")||b.hasClass("twc-calculation-field"))&&"1"!==quote_status&&r(b),"width"!==b.attr("name")&&"type"!==b.attr("name")||"1"===quote_status||w(b),"material"===b.attr("name")&&x(b),"width"===b.attr("name")||"drop"===b.attr("name")||"type"===b.attr("name")||b.hasClass("twc-calculation-field")?"1"!==quote_status?
u.done(function(){f=[g.serialize()];m(b,f)}):(f=[g.serialize()],m(b,f)):(f=[g.serialize()],m(b,f))});$(document).on("keypress",".add-twc-calculation-accessory-qty",function(a){13===a.keyCode&&(a.preventDefault(),$(this).siblings(".add-twc-calculation-accessories").click())});$(document).on("click",".add-twc-calculation-accessories",function(){var a=$(this),b=a.parents(".update-twc-calculation-quote-item-form"),c=a.siblings(".twc-calculation-accessories"),d=a.siblings(".add-twc-calculation-accessory-qty"),
g=b.find(".twc-calculation-code").val(),e=b.find(".twc-calculation-quote-item-code").val(),f=c.val(),k=+d.val();k=0!==k?k:1;f&&$.ajax({url:"twc-calculation/scripts/add-twc-calculation-quote-item-accessory.php",type:"POST",dataType:"json",data:{cid,twc_calculation_code:g,twc_calculation_quote_item_code:e,accessory:f,accessory_qty:k},beforeSend:function(){a.prop("disabled",!1).addClass("field-loader");c.addClass("field-loader");d.addClass("field-loader")},success:function(e){if(4===e[0])document.location.replace(e[1]);
else if(2===e[0])a.prop("disabled",!1).removeClass("field-loader"),c.removeClass("field-loader"),d.removeClass("field-loader"),alert(e[1]);else if(1===e[0]){e=f.split("<->")[0];var h=f.split("<->")[1],g=+f.split("<->")[2].replace(/,/g,""),l=(g*k).toFixed(2);b.find(".table-more-accessories").append('<span class="twc-calculation-accessories-wrapper">\n                                                                                <input type="text" class="twc-calculation-accessory" readonly disabled value="'+
h+" | "+g+" x "+k+" = "+l+'">\n                                                                                <input type="button" class="delete-twc-calculation-accessory bttn-input" data-code="'+e+'" value="\u2716">\n                                                                            </span>').find(".bttn-input").button();c.find('option[data-code="'+e+'"]').hide();c.val("").focus();d.val("");e=b.find(".twc-calculation-notes").val().length;h=b.find(".twc-calculation-accessory").length;g=
b.find(".twc-calculation-per-meter").length;l=b.find(".twc-calculation-fitting-charge").length;e||h||g||l?b.find(".twc-calculation-table-more-bttn").addClass("red"):b.find(".twc-calculation-table-more-bttn").removeClass("red");a.prop("disabled",!1).removeClass("field-loader");c.removeClass("field-loader");d.removeClass("field-loader");$("#getsum").load("getsum.php?cid="+cid).fadeIn("fast");$("#totalx").load("megaTotal.php?cid="+cid).fadeIn("fast")}else a.prop("disabled",!1).removeClass("field-loader"),
c.removeClass("field-loader"),d.removeClass("field-loader"),alert(JSON.stringify(e))},error:function(b,f,e){a.prop("disabled",!1).removeClass("field-loader");c.removeClass("field-loader");d.removeClass("field-loader");alert(JSON.stringify(b));alert("Error! @add-twc-calculation-quote-item-accessory")}})});$(document).on("click",".delete-twc-calculation-accessory",function(){var a=$(this),b=a.parents(".update-twc-calculation-quote-item-form"),c=b.find(".twc-calculation-accessories"),d=a.parent(".twc-calculation-accessories-wrapper"),
g=b.find(".twc-calculation-code").val(),e=b.find(".twc-calculation-quote-item-code").val(),f=a.attr("data-code");$.ajax({url:"twc-calculation/scripts/delete-twc-calculation-quote-item-accessory.php",type:"POST",dataType:"json",data:{cid,twc_calculation_code:g,twc_calculation_quote_item_code:e,accessory_code:f},beforeSend:function(){a.prop("disabled",!1).addClass("field-loader")},success:function(e){if(4===e[0])document.location.replace(e[1]);else if(2===e[0])a.prop("disabled",!1).removeClass("field-loader"),
alert(e[1]);else if(1===e[0]){d.remove();c.find('option[data-code="'+f+'"]').show();c.val("");e=b.find(".twc-calculation-notes").val().length;var k=b.find(".twc-calculation-accessory").length,h=b.find(".twc-calculation-per-meter").length,g=b.find(".twc-calculation-fitting-charge").length;e||k||h||g?b.find(".twc-calculation-table-more-bttn").addClass("red"):b.find(".twc-calculation-table-more-bttn").removeClass("red");a.prop("disabled",!1).removeClass("field-loader");$("#getsum").load("getsum.php?cid="+
cid).fadeIn("fast");$("#totalx").load("megaTotal.php?cid="+cid).fadeIn("fast")}else a.prop("disabled",!1).removeClass("field-loader"),alert(JSON.stringify(e))},error:function(b,c,d){a.prop("disabled",!1).removeClass("field-loader");alert(JSON.stringify(b));alert("Error! @delete-twc-calculation-quote-item-accessory")}})});$(document).on("keypress",".add-twc-calculation-per-meter-width",function(a){13===a.keyCode&&(a.preventDefault(),$(this).siblings(".add-twc-calculation-per-meters").click())});$(document).on("click",
".add-twc-calculation-per-meters",function(){var a=$(this),b=a.parents(".update-twc-calculation-quote-item-form"),c=a.siblings(".twc-calculation-per-meters"),d=a.siblings(".add-twc-calculation-per-meter-width"),g=b.find(".twc-calculation-code").val(),e=b.find(".twc-calculation-quote-item-code").val(),f=c.val(),k=+d.val();k=0!==k?k:1;f&&$.ajax({url:"twc-calculation/scripts/add-twc-calculation-quote-item-per-meter.php",type:"POST",dataType:"json",data:{cid,twc_calculation_code:g,twc_calculation_quote_item_code:e,
per_meter:f,per_meter_width:k},beforeSend:function(){a.prop("disabled",!1).addClass("field-loader");c.addClass("field-loader");d.addClass("field-loader")},success:function(e){if(4===e[0])document.location.replace(e[1]);else if(2===e[0])a.prop("disabled",!1).removeClass("field-loader"),c.removeClass("field-loader"),d.removeClass("field-loader"),alert(e[1]);else if(1===e[0]){e=f.split("<->")[0];var g=f.split("<->")[1],l=+f.split("<->")[2].replace(/,/g,""),m=(l*k).toFixed(2);b.find(".table-more-per-meters").append('<span class="twc-calculation-per-meters-wrapper">\n                                                                                <input type="text" class="twc-calculation-per-meter" readonly disabled value="'+
g+" | "+l+" x "+k+" = "+m+'">\n                                                                                <input type="button" class="delete-twc-calculation-per-meter bttn-input" data-code="'+e+'" value="\u2716">\n                                                                            </span>').find(".bttn-input").button();c.find('option[data-code="'+e+'"]').hide();c.val("").focus();d.val("");e=b.find(".twc-calculation-notes").val().length;g=b.find(".twc-calculation-accessory").length;l=
b.find(".twc-calculation-per-meter").length;m=b.find(".twc-calculation-fitting-charge").length;e||g||l||m?b.find(".twc-calculation-table-more-bttn").addClass("red"):b.find(".twc-calculation-table-more-bttn").removeClass("red");a.prop("disabled",!1).removeClass("field-loader");c.removeClass("field-loader");d.removeClass("field-loader");$("#getsum").load("getsum.php?cid="+cid).fadeIn("fast");$("#totalx").load("megaTotal.php?cid="+cid).fadeIn("fast")}else a.prop("disabled",!1).removeClass("field-loader"),
c.removeClass("field-loader"),d.removeClass("field-loader"),alert(JSON.stringify(e))},error:function(b,e,f){a.prop("disabled",!1).removeClass("field-loader");c.removeClass("field-loader");d.removeClass("field-loader");alert(JSON.stringify(b));alert("Error! @add-twc-calculation-quote-item-per-meter")}})});$(document).on("click",".delete-twc-calculation-per-meter",function(){var a=$(this),b=a.parents(".update-twc-calculation-quote-item-form"),c=b.find(".twc-calculation-per-meters"),d=a.parent(".twc-calculation-per-meters-wrapper"),
g=b.find(".twc-calculation-code").val(),e=b.find(".twc-calculation-quote-item-code").val(),f=a.attr("data-code");$.ajax({url:"twc-calculation/scripts/delete-twc-calculation-quote-item-per-meter.php",type:"POST",dataType:"json",data:{cid,twc_calculation_code:g,twc_calculation_quote_item_code:e,per_meter_code:f},beforeSend:function(){a.prop("disabled",!1).addClass("field-loader")},success:function(e){if(4===e[0])document.location.replace(e[1]);else if(2===e[0])a.prop("disabled",!1).removeClass("field-loader"),
alert(e[1]);else if(1===e[0]){d.remove();c.find('option[data-code="'+f+'"]').show();c.val("");e=b.find(".twc-calculation-notes").val().length;var g=b.find(".twc-calculation-accessory").length,k=b.find(".twc-calculation-per-meter").length,m=b.find(".twc-calculation-fitting-charge").length;e||g||k||m?b.find(".twc-calculation-table-more-bttn").addClass("red"):b.find(".twc-calculation-table-more-bttn").removeClass("red");a.prop("disabled",!1).removeClass("field-loader");$("#getsum").load("getsum.php?cid="+
cid).fadeIn("fast");$("#totalx").load("megaTotal.php?cid="+cid).fadeIn("fast")}else a.prop("disabled",!1).removeClass("field-loader"),alert(JSON.stringify(e))},error:function(b,c,d){a.prop("disabled",!1).removeClass("field-loader");alert(JSON.stringify(b));alert("Error! @delete-twc-calculation-quote-item-accessory")}})});$(document).on("click",".add-twc-calculation-fitting-charges",function(){var a=$(this),b=a.parents(".update-twc-calculation-quote-item-form"),c=a.siblings(".twc-calculation-fitting-charges"),
d=b.find(".twc-calculation-code").val(),g=b.find(".twc-calculation-quote-item-code").val(),e=c.val();e&&$.ajax({url:"twc-calculation/scripts/add-twc-calculation-quote-item-fitting-charge.php",type:"POST",dataType:"json",data:{cid,twc_calculation_code:d,twc_calculation_quote_item_code:g,fitting_charge:e},beforeSend:function(){a.prop("disabled",!1).addClass("field-loader");c.toggleClass("field-loader")},success:function(d){if(4===d[0])document.location.replace(d[1]);else if(2===d[0])a.prop("disabled",
!1).removeClass("field-loader"),c.toggleClass("field-loader"),alert(d[1]);else if(1===d[0]){d=e.split("<->")[0];var f=e.split("<->")[1],g=e.split("<->")[2];b.find(".table-more-fitting-charges").append('<span class="twc-calculation-fitting-charges-wrapper">\n                                                                                    <input type="text" class="twc-calculation-fitting-charge" readonly disabled value="'+f+" | "+g+'">\n                                                                                    <input type="button" class="delete-twc-calculation-fitting-charge bttn-input" data-code="'+
d+'" value="\u2716">\n                                                                                </span>').find(".bttn-input").button();c.find('option[data-code="'+d+'"]').hide();c.val("");d=b.find(".twc-calculation-notes").val().length;f=b.find(".twc-calculation-accessory").length;g=b.find(".twc-calculation-fitting-charge").length;d||f||g?b.find(".twc-calculation-table-more-bttn").addClass("red"):b.find(".twc-calculation-table-more-bttn").removeClass("red");a.prop("disabled",!1).removeClass("field-loader");
c.toggleClass("field-loader");$("#getsum").load("getsum.php?cid="+cid).fadeIn("fast");$("#totalx").load("megaTotal.php?cid="+cid).fadeIn("fast")}else a.prop("disabled",!1).removeClass("field-loader"),c.toggleClass("field-loader"),alert(JSON.stringify(d))},error:function(b,d,e){a.prop("disabled",!1).removeClass("field-loader");c.toggleClass("field-loader");alert(JSON.stringify(b));alert("Error! @add-twc-calculation-quote-item-fitting-charge")}})});$(document).on("click",".delete-twc-calculation-fitting-charge",
function(){var a=$(this),b=a.parents(".update-twc-calculation-quote-item-form"),c=b.find(".twc-calculation-fitting-charges"),d=a.parent(".twc-calculation-fitting-charges-wrapper"),g=b.find(".twc-calculation-code").val(),e=b.find(".twc-calculation-quote-item-code").val(),f=a.attr("data-code");$.ajax({url:"twc-calculation/scripts/delete-twc-calculation-quote-item-fitting-charge.php",type:"POST",dataType:"json",data:{cid,twc_calculation_code:g,twc_calculation_quote_item_code:e,fitting_charge_code:f},
beforeSend:function(){a.prop("disabled",!1).addClass("field-loader")},success:function(e){if(4===e[0])document.location.replace(e[1]);else if(2===e[0])a.prop("disabled",!1).removeClass("field-loader"),alert(e[1]);else if(1===e[0]){d.remove();c.find('option[data-code="'+f+'"]').show();c.val("");e=b.find(".twc-calculation-notes").val().length;var g=b.find(".twc-calculation-accessory").length,h=b.find(".twc-calculation-fitting-charge").length;e||g||h?b.find(".twc-calculation-table-more-bttn").addClass("red"):
b.find(".twc-calculation-table-more-bttn").removeClass("red");a.prop("disabled",!1).removeClass("field-loader");$("#getsum").load("getsum.php?cid="+cid).fadeIn("fast");$("#totalx").load("megaTotal.php?cid="+cid).fadeIn("fast")}else a.prop("disabled",!1).removeClass("field-loader"),alert(JSON.stringify(e))},error:function(b,c,d){a.prop("disabled",!1).removeClass("field-loader");alert(JSON.stringify(b));alert("Error! @delete-twc-calculation-quote-item-fitting-charge")}})});$(document).on("submit","#twc-calculation-quote-items-results .group-discount-form",
function(a){a.preventDefault();var b=$(this),c=$(this).find("input[type='submit']");a=isNaN(b.find(".group-discount").val())?"0":b.find(".group-discount").val();var d=isNaN(b.find(".group-total").val())?"0":b.find(".group-total").val(),g=b.find(".twc-calculation-code").val(),e=(d-d*a/100).toFixed(2);$.ajax({url:"twc-calculation/scripts/update-twc-calculation-group-discount.php",type:"POST",dataType:"json",data:{cid,discount:a,twc_calculation_code:g},beforeSend:function(){c.prop("disabled",!1).addClass("field-loader")},
success:function(a){4===a[0]?document.location.replace(a[1]):2===a[0]?(c.prop("disabled",!1).removeClass("field-loader"),alert(a[1])):1===a[0]?(b.siblings(".group-discount-total").html(e),c.prop("disabled",!1).removeClass("field-loader")):(c.prop("disabled",!1).removeClass("field-loader"),alert(JSON.stringify(a)));$("#getsum").load("getsum.php?cid="+cid).fadeIn("fast");$("#totalx").load("megaTotal.php?cid="+cid).fadeIn("fast")},error:function(a,b,d){c.prop("disabled",!1).removeClass("field-loader");
alert(JSON.stringify(a));alert("Error! @update-twc-calculation-group-discount")}})})});